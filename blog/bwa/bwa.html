<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2023-08-13 Sun 17:01 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Sequence Alignment from Scratch with BWA</title>
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>

<script async src="https://analytics.umami.is/script.js" data-website-id="c0d0b77c-5c98-4814-9721-bb72437e9467"></script>
<link rel="shortcut icon" href="https://omics.sbs/static/base/img/fav.ico" />
<link rel="stylesheet" href="https://omics.sbs/static/base/css/latex.css" />
<link rel="stylesheet" href="https://omics.sbs/static/base/css/style.css" />
<script>
// @license magnet:?xt=urn:btih:1f739d935676111cfff4b4693e3816e664797050&amp;dn=gpl-3.0.txt GPL-v3-or-Later
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.add("code-highlighted");
         target.classList.add("code-highlighted");
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.remove("code-highlighted");
         target.classList.remove("code-highlighted");
       }
     }
// @license-end
</script>
<script>
  window.MathJax = {
    tex: {
      ams: {
        multlineWidth: '85%'
      },
      tags: 'ams',
      tagSide: 'right',
      tagIndent: '.8em'
    },
    chtml: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    svg: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    output: {
      font: 'mathjax-modern',
      displayOverflow: 'overflow'
    }
  };
</script>

<script
  id="MathJax-script"
  async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
</head>
<body>
<div id="preamble" class="status">

<script>
if (localStorage.darkMode == "true") {
  document.body.classList.add("latex-dark");
}
else {
  document.body.classList.remove("latex-dark");
}
if (localStorage.typeface == "Libertinus") {
    document.body.classList.add("libertinus")
}
else {
    document.body.classList.remove("libertinus")
}
</script>

    <ul id="navbar">
        <li>
            <a href="https://omics.sbs/">Home</a>
        </li>
        <li>
            <a href="https://omics.sbs/blog">Blog</a>
        </li>
        <li>
            <a href="https://omics.sbs/notes">Notes</a>
        </li>
        <li>
            <a href="https://omics.sbs/bioscripts">Bioscripts</a>
        </li>
        <li class="preferences">
            <button class="dark-mode-button" id="dark-mode-toggle" aria-label="Toggle color mode"
                title="Toggle color mode">
                <div class="sun">
                </div>
                <div class="moon">
                    <div class="star"></div>
                    <div class="star small"></div>
                </div>
            </button>
        </li>
        <li class="preferences">
            <input type="button" id="typeface-toggle" title="" value="Aa">
        </li>
    </ul>
</div>
<div id="content" class="content">
<h1 class="title">Sequence Alignment from Scratch with BWA</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgd30fbff">1. Intro</a></li>
<li><a href="#org93dff9d">2. Implementation</a>
<ul>
<li><a href="#org30dc87d">2.1. What is Burrows Wheeler Transform</a></li>
<li><a href="#org756f075">2.2. What is FM-index</a></li>
<li><a href="#org2f3c473">2.3. Last to First Mapping</a></li>
<li><a href="#orgd1032b8">2.4. Building a class</a></li>
<li><a href="#org4a09c61">2.5. Mapping</a>
<ul>
<li><a href="#org0f96bf4">2.5.1. Exact Matching</a></li>
<li><a href="#orgff801a4">2.5.2. Inexact Matching</a></li>
</ul>
</li>
<li><a href="#org7f6be7d">2.6. Putting it all together</a></li>
<li><a href="#orgd10f402">2.7. Trying out with dummy data</a>
<ul>
<li><a href="#org76d0f31">2.7.1. Sequence generation</a></li>
<li><a href="#orge55d247">2.7.2. Mutating the sequence</a></li>
<li><a href="#orgfa310c0">2.7.3. Getting the reads</a></li>
<li><a href="#org9bfb0f0">2.7.4. Performing the alignment</a></li>
<li><a href="#org981b992">2.7.5. Outputing to SAM</a></li>
<li><a href="#org0d4b416">2.7.6. Visualizing our alignments with IGV</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org2a55f3c">3. Referanslar</a></li>
</ul>
</div>
</div>
<div class="abstract" id="org3f1902f">
<p>
The burrow wheeler algorithm is used to perform short read alignment, a cornerstone process in bioinformatics, especially next-generation sequencing.
Short sequence alignment or mapping is one of the primary steps in re-sequencing projects where short reads from a fragmented genome are aligned back to a reference genome.
We can use this aligned data to discover small or structural variations in clinical or population projects.
</p>

</div>

<div id="outline-container-orgd30fbff" class="outline-2">
<h2 id="orgd30fbff"><span class="section-number-2">1.</span> Intro</h2>
<div class="outline-text-2" id="text-1">
<label for="sn-symbol" class="sidenote-toggle">⊕</label>
<input type="checkbox" id="sn-symbol" class="sidenote-toggle">
<div class="sidenote" id="org5c81fd0">
<p>
Try it out yourself at this <a href="https://colab.research.google.com/drive/12idzfrTSRtEx5Dam9rTQcGv2c7s11nmo?usp=sharing">notebook</a>.
</p>

</div>


<p>
Living organisms have long strings of DNA in their cells and are made out of 4 bases <code>A, T, C, G</code>. The order that makes up the long stretches of DNA determines the characteristics of the cell. In the case of the human genome, the order of 3.25 billion of these bases decides the makeup of our cells.
Over the last few decades, we have had technologies that can reveal this order of bases called <i>sequencing</i>. However, the majority of these sequencing technologies can only sequence around 100 bases which are not very long. However, the strength of these sequencing methods lies in their massive capacity to perform this sequencing operation millions of times in parallel. To get a more comprehensive view, we need to put these millions of small 100-base long sequences back together. It&rsquo;s a wide puzzle with small and many pieces.
We have sequenced genomes lots of organisms and now have picture for the puzzle that we can use as reference. However, not every individual and their genome is the same so when we are doing resequencing pieces come from a different picture. Having pieces from another picture makes solving the puzzle bit more challenging. We don&rsquo;t know what is different in these pieces and we need to account for that unknown when putting the pieces together.
Burrows-Wheeler Transform makes it possible to put these pieces to their place despite their variation. Our end goals is to identify these differences (variation) which makes that organism unique. There are few approaches but in this tutorial we are gonna use FM-index which is used by Burrows-Wheeler Aligner. There are lots of terminology here so lets explain while showing.
</p>
</div>
</div>

<div id="outline-container-org93dff9d" class="outline-2">
<h2 id="org93dff9d"><span class="section-number-2">2.</span> Implementation</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-org30dc87d" class="outline-3">
<h3 id="org30dc87d"><span class="section-number-3">2.1.</span> What is Burrows Wheeler Transform</h3>
<div class="outline-text-3" id="text-2-1">
<label for="sn-symbol" class="sidenote-toggle">⊕</label>
<input type="checkbox" id="sn-symbol" class="sidenote-toggle">
<div class="sidenote" id="org3838ad1">
<p>
Burrows-wheeler algorithm relies on burrows wheeler transform. This transform is performed once on the reference sequence before the alignment.
</p>

</div>

<ol class="org-ol">
<li>Burrows-Wheeler Transform(BWT) is performed by first getting the all the possible rotations (or circular shifts) of the sequence. Lets say we have example reference sequence string <code>OMICSSBS</code>. We can get the possible rotations with string splicing below.</li>
</ol>

<label for="sn-symbol" class="sidenote-toggle">⊕</label>
<input type="checkbox" id="sn-symbol" class="sidenote-toggle">
<div class="sidenote" id="org31dbc61">
<p>
We loop over the length of the string and for every loop we add slices of the string from start and end as the index increments we get the shifting effect.
</p>

</div>


<div class="org-src-container">
<pre class="src src-python"><span style="color: #e45649;">from</span> pprint <span style="color: #e45649;">import</span> pprint

<span style="color: #6a1868;">example_seq</span> = <span style="color: #50a14f;">"OMICSSBS$"</span>
<span style="color: #6a1868;">sequence_rotations</span> = []
<span style="color: #e45649;">for</span> index <span style="color: #e45649;">in</span> <span style="color: #a626a4;">range</span>(<span style="color: #a626a4;">len</span>(example_seq)):
    sequence_rotations.append(example_seq[index:] + example_seq[:index])
pprint(sequence_rotations)
</pre>
</div>

<pre class="example">
['OMICSSBS$',
 'MICSSBS$O',
 'ICSSBS$OM',
 'CSSBS$OMI',
 'SSBS$OMIC',
 'SBS$OMICS',
 'BS$OMICSS',
 'S$OMICSSB',
 '$OMICSSBS']
</pre>


<ol class="org-ol">
<li value="2">Then we sort rotations by a property we desire. In this case we are going to sort them alphabetically (or lexicographically if you&rsquo;re fancy).</li>
</ol>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #6a1868;">sorted_sequence_rotations</span> = <span style="color: #a626a4;">sorted</span>(sequence_rotations)
pprint(sorted_sequence_rotations)
</pre>
</div>

<pre class="example">
['$OMICSSBS',
 'BS$OMICSS',
 'CSSBS$OMI',
 'ICSSBS$OM',
 'MICSSBS$O',
 'OMICSSBS$',
 'S$OMICSSB',
 'SBS$OMICS',
 'SSBS$OMIC']
</pre>


<ol class="org-ol">
<li value="3">We get the last column of this sorted rotation.</li>
</ol>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #e45649;">for</span> sequence <span style="color: #e45649;">in</span> sorted_sequence_rotations:
    pprint(sequence[-<span style="color: #da8548; font-weight: bold;">1</span>])
</pre>
</div>

<pre class="example">
'S'
'S'
'I'
'M'
'O'
'$'
'B'
'S'
'C'
</pre>


<p>
And that&rsquo;s it. We done the BWT. To utilize this let&rsquo;s move to next step creating the FM-index.
</p>
</div>
</div>

<div id="outline-container-org756f075" class="outline-3">
<h3 id="org756f075"><span class="section-number-3">2.2.</span> What is FM-index</h3>
<div class="outline-text-3" id="text-2-2">
<p>
To utilize BWT we need to keep a bit more information. This information is the initial order of the sequences before sorting. Here we use the itemgetter to sort the enumerated rotations by the sequences themselves.
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #e45649;">from</span> operator <span style="color: #e45649;">import</span> itemgetter
<span style="color: #6a1868;">initial_indices</span>, <span style="color: #6a1868;">sorted_sequence_rotations</span> = <span style="color: #a626a4;">zip</span>(*<span style="color: #a626a4;">sorted</span>(<span style="color: #a626a4;">enumerate</span>(sequence_rotations), key=itemgetter(<span style="color: #da8548; font-weight: bold;">1</span>)))

<span style="color: #e45649;">for</span> index, sequence <span style="color: #e45649;">in</span> <span style="color: #a626a4;">zip</span>(initial_indices, sorted_sequence_rotations):
    <span style="color: #a626a4;">print</span>(f<span style="color: #50a14f;">"Initial index: </span>{index}<span style="color: #50a14f;"> of the: </span>{sequence[-1]}<span style="color: #50a14f;">"</span>)
</pre>
</div>

<pre class="example">
Initial index: 8 of the: S
Initial index: 6 of the: S
Initial index: 3 of the: I
Initial index: 2 of the: M
Initial index: 1 of the: O
Initial index: 0 of the: $
Initial index: 7 of the: B
Initial index: 5 of the: S
Initial index: 4 of the: C
</pre>



<label for="sn-symbol" class="sidenote-toggle">⊕</label>
<input type="checkbox" id="sn-symbol" class="sidenote-toggle">
<div class="sidenote" id="orgacf9166">
<p>
Suffix array is the sequences that are up character <code>$</code> which is used by bowtie.
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #e45649;">for</span> index, sequence <span style="color: #e45649;">in</span> <span style="color: #a626a4;">zip</span>(initial_indices, sorted_sequence_rotations):
    <span style="color: #a626a4;">print</span>(f<span style="color: #50a14f;">"Initial index: </span>{index}<span style="color: #50a14f;"> of the sequence: </span>{sequence.split('$')[0]}<span style="color: #50a14f;">"</span>)
</pre>
</div>

<pre class="example">
Initial index: 8 of the sequence:
Initial index: 6 of the sequence: BS
Initial index: 3 of the sequence: CSSBS
Initial index: 2 of the sequence: ICSSBS
Initial index: 1 of the sequence: MICSSBS
Initial index: 0 of the sequence: OMICSSBS
Initial index: 7 of the sequence: S
Initial index: 5 of the sequence: SBS
Initial index: 4 of the sequence: SSBS
</pre>

</div>

<p>
We can keep the last column in a sequence.
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #6a1868;">last_column</span> = <span style="color: #50a14f;">""</span>
<span style="color: #e45649;">for</span> sequence <span style="color: #e45649;">in</span> sorted_sequence_rotations:
    <span style="color: #6a1868;">last_column</span> += sequence[-<span style="color: #da8548; font-weight: bold;">1</span>]
<span style="color: #a626a4;">print</span>(last_column)
</pre>
</div>

<pre class="example">
SSIMO$BSC
</pre>


<p>
This transformation is reversible and we can get our original sequence back by back tracking the characters in the sequence. To make this back tracking work we need a function that maps the character in last back to first. This is possible because index of an <i>occurrence</i> of a character in the first column will be the same in the last column. e.g. We have three <code>S</code> characters in our string <code>OMICSSBS</code> where the first occurrence of the string <code>S</code> in last column is the same <code>S</code> in the first column. We can keep track of the occurrences of <code>S</code> like below. You can watch the index beside the <code>S</code> characters and confirm they&rsquo;re the same by the whole sequence besides them.
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #6a1868;">occurrence_of_s_in_first_column</span> = <span style="color: #da8548; font-weight: bold;">0</span>
<span style="color: #6a1868;">occurrence_of_s_in_last_column</span> = <span style="color: #da8548; font-weight: bold;">0</span>
<span style="color: #e45649;">for</span> index, sequence <span style="color: #e45649;">in</span> <span style="color: #a626a4;">zip</span>(initial_indices, sorted_sequence_rotations):
    <span style="color: #e45649;">if</span> sequence[<span style="color: #da8548; font-weight: bold;">0</span>] == <span style="color: #50a14f;">'S'</span> <span style="color: #e45649;">and</span> sequence[-<span style="color: #da8548; font-weight: bold;">1</span>] == <span style="color: #50a14f;">'S'</span>:
        <span style="color: #a626a4;">print</span>(f<span style="color: #50a14f;">"</span>{index=}<span style="color: #50a14f;"> sequence: </span>{sequence}<span style="color: #50a14f;"> first: </span>{sequence[0]}<span style="color: #50a14f;"> </span>{occurrence_of_s_in_first_column}<span style="color: #50a14f;"> last: </span>{sequence[-1]}<span style="color: #50a14f;"> </span>{occurrence_of_s_in_last_column}<span style="color: #50a14f;">"</span>)
        <span style="color: #6a1868;">occurrence_of_s_in_first_column</span> += <span style="color: #da8548; font-weight: bold;">1</span>
        <span style="color: #6a1868;">occurrence_of_s_in_last_column</span> += <span style="color: #da8548; font-weight: bold;">1</span>
    <span style="color: #e45649;">elif</span> sequence[<span style="color: #da8548; font-weight: bold;">0</span>] == <span style="color: #50a14f;">'S'</span>:
        <span style="color: #a626a4;">print</span>(f<span style="color: #50a14f;">"</span>{index=}<span style="color: #50a14f;"> sequence: </span>{sequence}<span style="color: #50a14f;"> first: </span>{sequence[0]}<span style="color: #50a14f;"> </span>{occurrence_of_s_in_first_column}<span style="color: #50a14f;"> last: </span>{sequence[-1]}<span style="color: #50a14f;"> 0"</span>)
        <span style="color: #6a1868;">occurrence_of_s_in_first_column</span> += <span style="color: #da8548; font-weight: bold;">1</span>
    <span style="color: #e45649;">elif</span> sequence[-<span style="color: #da8548; font-weight: bold;">1</span>] == <span style="color: #50a14f;">'S'</span>:
        <span style="color: #a626a4;">print</span>(f<span style="color: #50a14f;">"</span>{index=}<span style="color: #50a14f;"> sequence: </span>{sequence}<span style="color: #50a14f;"> first: </span>{sequence[0]}<span style="color: #50a14f;"> 0 last: </span>{sequence[-1]}<span style="color: #50a14f;"> </span>{occurrence_of_s_in_last_column}<span style="color: #50a14f;">"</span>)
        <span style="color: #6a1868;">occurrence_of_s_in_last_column</span> += <span style="color: #da8548; font-weight: bold;">1</span>
    <span style="color: #e45649;">else</span>:
        <span style="color: #a626a4;">print</span>(f<span style="color: #50a14f;">"</span>{index=}<span style="color: #50a14f;"> sequence: </span>{sequence}<span style="color: #50a14f;"> first: </span>{sequence[0]}<span style="color: #50a14f;"> 0 last: </span>{sequence[-1]}<span style="color: #50a14f;"> 0"</span>)
</pre>
</div>

<pre class="example">
index=8 sequence: $OMICSSBS first: $ 0 last: S 0
index=6 sequence: BS$OMICSS first: B 0 last: S 1
index=3 sequence: CSSBS$OMI first: C 0 last: I 0
index=2 sequence: ICSSBS$OM first: I 0 last: M 0
index=1 sequence: MICSSBS$O first: M 0 last: O 0
index=0 sequence: OMICSSBS$ first: O 0 last: $ 0
index=7 sequence: S$OMICSSB first: S 0 last: B 0
index=5 sequence: SBS$OMICS first: S 1 last: S 2
index=4 sequence: SSBS$OMIC first: S 2 last: C 0
</pre>


<p>
Instead of counting them characters one by one like above lets count all the characters and keep it in a lookup index using the last column. The <code>totals</code> is how many times we see a character in total and <code>tallymatrix</code> is how many we saw up to a given point.
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #6a1868;">totals</span> = {k: <span style="color: #da8548; font-weight: bold;">0</span> <span style="color: #e45649;">for</span> k <span style="color: #e45649;">in</span> <span style="color: #50a14f;">""</span>.join(<span style="color: #a626a4;">set</span>(last_column))}
<span style="color: #6a1868;">tallymatrix</span> = {k: [] <span style="color: #e45649;">for</span> k <span style="color: #e45649;">in</span> <span style="color: #50a14f;">""</span>.join(<span style="color: #a626a4;">set</span>(last_column))}
<span style="color: #e45649;">for</span> c <span style="color: #e45649;">in</span> last_column:
    <span style="color: #6a1868;">totals</span>[c] += <span style="color: #da8548; font-weight: bold;">1</span>
    <span style="color: #e45649;">for</span> k <span style="color: #e45649;">in</span> tallymatrix.keys():
        <span style="color: #e45649;">if</span> k != c <span style="color: #e45649;">and</span> tallymatrix[k]:
            tallymatrix[k].append(tallymatrix[k][-<span style="color: #da8548; font-weight: bold;">1</span>])
        <span style="color: #e45649;">elif</span> k == c:
            tallymatrix[k].append(totals[c])
        <span style="color: #e45649;">else</span>:
            tallymatrix[k].append(<span style="color: #da8548; font-weight: bold;">0</span>)
<span style="color: #a626a4;">print</span>(totals)
<span style="color: #a626a4;">print</span>(tallymatrix)
</pre>
</div>

<pre class="example">
{'O': 1, 'S': 3, 'M': 1, 'C': 1, 'B': 1, '$': 1, 'I': 1}
{'O': [0, 0, 0, 0, 1, 1, 1, 1, 1], 'S': [1, 2, 2, 2, 2, 2, 2, 3, 3], 'M': [0, 0, 0, 1, 1, 1, 1, 1, 1], 'C': [0, 0, 0, 0, 0, 0, 0, 0, 1], 'B': [0, 0, 0, 0, 0, 0, 1, 1, 1], '$': [0, 0, 0, 0, 0, 1, 1, 1, 1], 'I': [0, 0, 1, 1, 1, 1, 1, 1, 1]}
</pre>


<p>
Using this we can rebuild a index of where we start and stop seeing the characters in the first column.
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #6a1868;">first</span> = {}
<span style="color: #6a1868;">totc</span> = <span style="color: #da8548; font-weight: bold;">0</span>
<span style="color: #e45649;">for</span> c, count <span style="color: #e45649;">in</span> <span style="color: #a626a4;">sorted</span>(totals.items()):
    <span style="color: #6a1868;">first</span>[c] = (totc, totc + count)
    <span style="color: #6a1868;">totc</span> += count
<span style="color: #a626a4;">print</span>(first)
</pre>
</div>

<pre class="example">
{'$': (0, 1), 'B': (1, 2), 'C': (2, 3), 'I': (3, 4), 'M': (4, 5), 'O': (5, 6), 'S': (6, 9)}
</pre>


<p>
<b>This simplified representation of the first column and BWT is the FM-index</b>
</p>
</div>
</div>

<div id="outline-container-org2f3c473" class="outline-3">
<h3 id="org2f3c473"><span class="section-number-3">2.3.</span> Last to First Mapping</h3>
<div class="outline-text-3" id="text-2-3">
<p>
Using the we can map a given character with an index <code>i</code> back to first column. e.g <code>S</code> with second occurrence should map to row with initial index 4 witch is the 8th row.
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a626a4;">print</span>(first[<span style="color: #50a14f;">"S"</span>][<span style="color: #da8548; font-weight: bold;">0</span>] + tallymatrix[<span style="color: #50a14f;">"S"</span>][<span style="color: #da8548; font-weight: bold;">2</span>])
</pre>
</div>

<pre class="example">
8
</pre>


<p>
We can than reverse our transformation to build back our initial sequence. We remove one from the counts so we can use it as an index.
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #6a1868;">i</span> = <span style="color: #da8548; font-weight: bold;">0</span>
<span style="color: #6a1868;">t</span> = <span style="color: #50a14f;">"$"</span>
<span style="color: #e45649;">while</span> last_column[i] != <span style="color: #50a14f;">"$"</span>:
    <span style="color: #6a1868;">c</span> = last_column[i]
    <span style="color: #6a1868;">t</span> = c + t
    <span style="color: #6a1868;">i</span> = first[c][<span style="color: #da8548; font-weight: bold;">0</span>] + tallymatrix[c][i] - <span style="color: #da8548; font-weight: bold;">1</span>
<span style="color: #a626a4;">print</span>(t)
</pre>
</div>

<pre class="example">
OMICSSBS$
</pre>


<p>
To get a better grasp of whats happening lets track the index jumps too.
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #6a1868;">i</span> = <span style="color: #da8548; font-weight: bold;">0</span>
<span style="color: #6a1868;">t</span> = <span style="color: #50a14f;">"$"</span>
<span style="color: #6a1868;">j</span> = <span style="color: #da8548; font-weight: bold;">0</span>
<span style="color: #a626a4;">print</span>(f<span style="color: #50a14f;">"loop</span><span style="color: #b751b6;">\t</span><span style="color: #50a14f;">loopindex</span><span style="color: #b751b6;">\t</span><span style="color: #50a14f;">index</span><span style="color: #b751b6;">\t</span><span style="color: #50a14f;">initial_ind</span><span style="color: #b751b6;">\t</span><span style="color: #50a14f;">first_column</span><span style="color: #b751b6;">\t</span><span style="color: #50a14f;">last_column</span><span style="color: #b751b6;">\t</span><span style="color: #50a14f;">c</span><span style="color: #b751b6;">\t</span><span style="color: #50a14f;">t</span><span style="color: #b751b6;">\n</span><span style="color: #50a14f;">"</span>)
<span style="color: #e45649;">while</span> last_column[i] != <span style="color: #50a14f;">"$"</span>:
    <span style="color: #6a1868;">c</span> = last_column[i]
    <span style="color: #6a1868;">t</span> = c + t
    <span style="color: #6a1868;">i</span> = first[c][<span style="color: #da8548; font-weight: bold;">0</span>] + tallymatrix[c][i] - <span style="color: #da8548; font-weight: bold;">1</span>
    <span style="color: #6a1868;">j</span> += <span style="color: #da8548; font-weight: bold;">1</span>
    <span style="color: #a626a4;">print</span>(f<span style="color: #50a14f;">"END</span>{j:13}<span style="color: #50a14f;"> </span>{i:8}<span style="color: #50a14f;"> </span>{initial_indices[j]:8}{' '*14}{[seq[0] <span style="color: #e45649;">for</span> seq <span style="color: #e45649;">in</span> sorted_sequence_rotations][j]:12}<span style="color: #50a14f;"> </span>{[seq[-1] <span style="color: #e45649;">for</span> seq <span style="color: #e45649;">in</span> sorted_sequence_rotations][j]:14}<span style="color: #50a14f;"> </span>{c:3}<span style="color: #50a14f;"> </span>{t}<span style="color: #50a14f;">"</span>)
</pre>
</div>

<pre class="example" id="orgac66082">
loop	loopindex	index	initial_ind	first_column	last_column	c	t

END          1          6          6                B               S           S       S$
END          2          1          3                C               I           B       BS$
END          3          7          2                I               M           S       SBS$
END          4          8          1                M               O           S       SSBS$
END          5          2          0                O               $           C       CSSBS$
END          6          3          7                S               B           I       ICSSBS$
END          7          4          5                S               S           M       MICSSBS$
END          8          5          4                S               C           O       OMICSSBS$
</pre>

<p>
Here we are building up the initial sequence backwards. Observe below the &ldquo;index&rdquo;, &ldquo;last​_column&rdquo; and &ldquo;c&rdquo; columns. We initiate the <code>index​=0</code> which points us to character <code>S</code> in the last column, this <code>S</code> in turn with its <code>index​=6</code> points to preceding character <code>B</code>.
</p>
</div>
</div>

<div id="outline-container-orgd1032b8" class="outline-3">
<h3 id="orgd1032b8"><span class="section-number-3">2.4.</span> Building a class</h3>
<div class="outline-text-3" id="text-2-4">
<p>
Keeping track of the intermediately data and passing them through functions can become confusing to keep all this in one place lets put them in a <code>class</code>. Classes are a way of bundling data and functionality in python.
</p>

<p>
Our class aptly named <code>BWA</code> takes a reference sequence and creates the BWT and FM-index when initialized.
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #e45649;">from</span> operator <span style="color: #e45649;">import</span> itemgetter


<span style="color: #e45649;">class</span> <span style="color: #986801;">BWA</span>:
    <span style="color: #e45649;">def</span> <span style="color: #a626a4;">__init__</span>(<span style="color: #e45649;">self</span>, ref):
        <span style="color: #84888b; font-style: italic;">"""</span><span style="color: #986801; font-weight: bold; font-style: italic;">TODO:</span><span style="color: #84888b; font-style: italic;"> to be defined1."""</span>
        <span style="color: #e45649;">self</span>.<span style="color: #6a1868;">ref</span> = ref + <span style="color: #50a14f;">"$"</span>

    @<span style="color: #a626a4;">property</span>
    <span style="color: #e45649;">def</span> <span style="color: #a626a4;">last</span>(<span style="color: #e45649;">self</span>):
        <span style="color: #84888b; font-style: italic;">'''</span>
<span style="color: #84888b; font-style: italic;">        Get all the rotations of given sequence, sort them alphabetically and</span>
<span style="color: #84888b; font-style: italic;">        return the last character from each rotation</span>
<span style="color: #84888b; font-style: italic;">        '''</span>
        <span style="color: #6a1868;">sa</span> = [<span style="color: #e45649;">self</span>.ref[i:] + <span style="color: #e45649;">self</span>.ref[:i] <span style="color: #e45649;">for</span> i <span style="color: #e45649;">in</span> <span style="color: #a626a4;">range</span>(<span style="color: #a626a4;">len</span>(<span style="color: #e45649;">self</span>.ref))]
        <span style="color: #e45649;">return</span> <span style="color: #50a14f;">""</span>.join(i[-<span style="color: #da8548; font-weight: bold;">1</span>] <span style="color: #e45649;">for</span> i <span style="color: #e45649;">in</span> <span style="color: #a626a4;">sorted</span>(sa))

    @<span style="color: #a626a4;">property</span>
    <span style="color: #e45649;">def</span> <span style="color: #a626a4;">occ</span>(<span style="color: #e45649;">self</span>):
        <span style="color: #84888b; font-style: italic;">'''</span>
<span style="color: #84888b; font-style: italic;">        Get the occurrences and total counts for each character in bwt</span>
<span style="color: #84888b; font-style: italic;">        '''</span>
        <span style="color: #6a1868;">totals</span> = {}
        <span style="color: #6a1868;">tallymatrix</span> = {k: [] <span style="color: #e45649;">for</span> k <span style="color: #e45649;">in</span> <span style="color: #50a14f;">""</span>.join(<span style="color: #a626a4;">set</span>(<span style="color: #e45649;">self</span>.last))}
        <span style="color: #e45649;">for</span> c <span style="color: #e45649;">in</span> <span style="color: #e45649;">self</span>.last:
            <span style="color: #e45649;">if</span> c <span style="color: #e45649;">not</span> <span style="color: #e45649;">in</span> totals:
                <span style="color: #6a1868;">totals</span>[c] = <span style="color: #da8548; font-weight: bold;">0</span>
            <span style="color: #6a1868;">totals</span>[c] += <span style="color: #da8548; font-weight: bold;">1</span>
            <span style="color: #e45649;">for</span> k <span style="color: #e45649;">in</span> tallymatrix.keys():
                <span style="color: #e45649;">if</span> k != c <span style="color: #e45649;">and</span> tallymatrix[k]:
                    tallymatrix[k].append(tallymatrix[k][-<span style="color: #da8548; font-weight: bold;">1</span>])
                <span style="color: #e45649;">elif</span> k == c:
                    tallymatrix[k].append(totals[c])
                <span style="color: #e45649;">else</span>:
                    tallymatrix[k].append(<span style="color: #da8548; font-weight: bold;">0</span>)
        <span style="color: #e45649;">return</span> tallymatrix, totals

    @<span style="color: #a626a4;">property</span>
    <span style="color: #e45649;">def</span> <span style="color: #a626a4;">first</span>(<span style="color: #e45649;">self</span>):
        <span style="color: #84888b; font-style: italic;">'''</span>
<span style="color: #84888b; font-style: italic;">        Get the lexicographical order of the characters</span>
<span style="color: #84888b; font-style: italic;">        '''</span>
        <span style="color: #6a1868;">first</span> = {}
        <span style="color: #6a1868;">totc</span> = <span style="color: #da8548; font-weight: bold;">0</span>
        <span style="color: #e45649;">for</span> c, count <span style="color: #e45649;">in</span> <span style="color: #a626a4;">sorted</span>(<span style="color: #e45649;">self</span>.occ[<span style="color: #da8548; font-weight: bold;">1</span>].items()):
            <span style="color: #6a1868;">first</span>[c] = totc
            <span style="color: #6a1868;">totc</span> += count
        <span style="color: #e45649;">return</span> first

    <span style="color: #e45649;">def</span> <span style="color: #a626a4;">lf</span>(<span style="color: #e45649;">self</span>, c, i):
        <span style="color: #84888b; font-style: italic;">"""</span>
<span style="color: #84888b; font-style: italic;">        The i-th occurrence of character &#8216;c&#8217; in last is the same text character</span>
<span style="color: #84888b; font-style: italic;">        as the i-th occurrence of &#8216;c&#8217; in the first</span>
<span style="color: #84888b; font-style: italic;">        """</span>
        <span style="color: #e45649;">return</span> <span style="color: #e45649;">self</span>.first[c] + <span style="color: #e45649;">self</span>.occ[<span style="color: #da8548; font-weight: bold;">0</span>][c][i] - <span style="color: #da8548; font-weight: bold;">1</span>

    @<span style="color: #a626a4;">property</span>
    <span style="color: #e45649;">def</span> <span style="color: #a626a4;">rebwt</span>(<span style="color: #e45649;">self</span>):
        <span style="color: #84888b; font-style: italic;">'''</span>
<span style="color: #84888b; font-style: italic;">        rebuild the original sequence</span>
<span style="color: #84888b; font-style: italic;">        '''</span>
        <span style="color: #6a1868;">i</span> = <span style="color: #da8548; font-weight: bold;">0</span>
        <span style="color: #6a1868;">t</span> = <span style="color: #50a14f;">"$"</span>
        <span style="color: #e45649;">while</span> <span style="color: #e45649;">self</span>.last[i] != <span style="color: #50a14f;">"$"</span>:
            <span style="color: #6a1868;">c</span> = <span style="color: #e45649;">self</span>.last[i]
            <span style="color: #6a1868;">t</span> = c + t
            <span style="color: #6a1868;">i</span> = <span style="color: #e45649;">self</span>.lf(c, i)
        <span style="color: #e45649;">return</span> t[:-<span style="color: #da8548; font-weight: bold;">1</span>]
</pre>
</div>

<p>
We can initialize our function with our reference and access the BWT and FM-index as its properties.
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #6a1868;">example_seq</span> = <span style="color: #50a14f;">"OMICSSBS"</span>
<span style="color: #6a1868;">bwa</span> = BWA(example_seq)
<span style="color: #a626a4;">print</span>(f<span style="color: #50a14f;">"</span>{bwa.last=}<span style="color: #50a14f;">"</span>)
<span style="color: #a626a4;">print</span>(f<span style="color: #50a14f;">"</span>{bwa.first=}<span style="color: #50a14f;">"</span>)
<span style="color: #a626a4;">print</span>(f<span style="color: #50a14f;">"</span>{bwa.occ=}<span style="color: #50a14f;">"</span>)
<span style="color: #a626a4;">print</span>(f<span style="color: #50a14f;">"</span>{bwa.rebwt=}<span style="color: #50a14f;">"</span>)
</pre>
</div>

<pre class="example">
bwa.last=('SSIMO$BSC', (8, 6, 3, 2, 1, 0, 7, 5, 4), ('$OMICSSBS', 'BS$OMICSS', 'CSSBS$OMI', 'ICSSBS$OM', 'MICSSBS$O', 'OMICSSBS$', 'S$OMICSSB', 'SBS$OMICS', 'SSBS$OMIC'))
bwa.first={'$': (0, 0), 'B': (1, 1), 'C': (2, 2), 'I': (3, 3), 'M': (4, 4), 'O': (5, 5), 'S': (6, 8)}
bwa.occ=({'O': [0, 0, 0, 0, 1, 1, 1, 1, 1], 'S': [1, 2, 2, 2, 2, 2, 2, 3, 3], 'M': [0, 0, 0, 1, 1, 1, 1, 1, 1], 'C': [0, 0, 0, 0, 0, 0, 0, 0, 1], 'B': [0, 0, 0, 0, 0, 0, 1, 1, 1], '$': [0, 0, 0, 0, 0, 1, 1, 1, 1], 'I': [0, 0, 1, 1, 1, 1, 1, 1, 1]}, {'S': 3, 'I': 1, 'M': 1, 'O': 1, '$': 1, 'B': 1, 'C': 1})
bwa.rebwt='OMICSSBS'
</pre>
</div>
</div>

<div id="outline-container-org4a09c61" class="outline-3">
<h3 id="org4a09c61"><span class="section-number-3">2.5.</span> Mapping</h3>
<div class="outline-text-3" id="text-2-5">
</div>
<div id="outline-container-org0f96bf4" class="outline-4">
<h4 id="org0f96bf4"><span class="section-number-4">2.5.1.</span> Exact Matching</h4>
<div class="outline-text-4" id="text-2-5-1">
<p>
We want to align the small sequences back to references. If we have a <code>read</code> sequence with no variations. We can do a backward search to match a substring. We start by getting the minimum and maximum indices of the last character. Than we map these using our <code>lf</code> function in a loop.
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #6a1868;">low</span>, <span style="color: #6a1868;">high</span> = <span style="color: #e45649;">self</span>.last[<span style="color: #da8548; font-weight: bold;">0</span>].find(read[-<span style="color: #da8548; font-weight: bold;">1</span>]), <span style="color: #e45649;">self</span>.last[<span style="color: #da8548; font-weight: bold;">0</span>].rfind(read[-<span style="color: #da8548; font-weight: bold;">1</span>])

<span style="color: #6a1868;">i</span> = <span style="color: #a626a4;">len</span>(read) - <span style="color: #da8548; font-weight: bold;">1</span>
<span style="color: #e45649;">while</span> low &lt;= high <span style="color: #e45649;">and</span> i &gt;= <span style="color: #da8548; font-weight: bold;">0</span>:
    <span style="color: #6a1868;">low</span> = <span style="color: #e45649;">self</span>.lf(read[i], low)
    <span style="color: #6a1868;">high</span> = <span style="color: #e45649;">self</span>.lf(read[i], high)
    <span style="color: #6a1868;">i</span> -= <span style="color: #da8548; font-weight: bold;">1</span>
<span style="color: #e45649;">return</span> low, high
</pre>
</div>

<p>
Let&rsquo;s add this to our class too.
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #e45649;">from</span> operator <span style="color: #e45649;">import</span> itemgetter


<span style="color: #e45649;">class</span> <span style="color: #986801;">BWA</span>:
    .
    .
    .

    <span style="color: #e45649;">def</span> <span style="color: #a626a4;">exact_match</span>(<span style="color: #e45649;">self</span>, read):
        <span style="color: #6a1868;">low</span>, <span style="color: #6a1868;">high</span> = <span style="color: #e45649;">self</span>.last[<span style="color: #da8548; font-weight: bold;">0</span>].find(read[-<span style="color: #da8548; font-weight: bold;">1</span>]), <span style="color: #e45649;">self</span>.last[<span style="color: #da8548; font-weight: bold;">0</span>].rfind(read[-<span style="color: #da8548; font-weight: bold;">1</span>])

        <span style="color: #6a1868;">i</span> = <span style="color: #a626a4;">len</span>(read) - <span style="color: #da8548; font-weight: bold;">1</span>
        <span style="color: #e45649;">while</span> low &lt;= high <span style="color: #e45649;">and</span> i &gt;= <span style="color: #da8548; font-weight: bold;">0</span>:
            <span style="color: #6a1868;">low</span> = <span style="color: #e45649;">self</span>.lf(read[i], low)
            <span style="color: #6a1868;">high</span> = <span style="color: #e45649;">self</span>.lf(read[i], high)
            <span style="color: #6a1868;">i</span> -= <span style="color: #da8548; font-weight: bold;">1</span>
        <span style="color: #e45649;">return</span> low, high
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #6a1868;">read</span> = <span style="color: #50a14f;">"OMI"</span>
<span style="color: #6a1868;">bwa</span> = BWA(example_seq)
<span style="color: #6a1868;">low</span>, <span style="color: #6a1868;">high</span> = bwa.exact_match(read)
<span style="color: #6a1868;">initial_ind</span> = bwa.last[<span style="color: #da8548; font-weight: bold;">1</span>][low]
<span style="color: #a626a4;">print</span>(low, high)
<span style="color: #a626a4;">print</span>(initial_ind)
<span style="color: #a626a4;">print</span>(example_seq[initial_ind:initial_ind + <span style="color: #a626a4;">len</span>(read)])
</pre>
</div>

<pre class="example" id="orge4be0a3">
5 5
0
OMI
</pre>
</div>
</div>

<div id="outline-container-orgff801a4" class="outline-4">
<h4 id="orgff801a4"><span class="section-number-4">2.5.2.</span> Inexact Matching</h4>
<div class="outline-text-4" id="text-2-5-2">
<p>
Most crucial part is of course matching the reads with variations. Backtracking algorithm described by (<a href="#citeproc_bib_item_1">Li and Durbin 2009</a>) accounts for insertions, deletions and mismatches.
</p>


<div id="orgc1bbb48" class="figure">
<p><img src="./fig3.jpeg" alt="fig3.jpeg" width="50%" />
</p>
</div>

<p>
Inexact search calls the function <code>calculate_diff</code> initially which calculates the lower bound of differences for each character in the read string.
Then we call the <code>inexact_match</code> which in turns calls itself <a href="https://www.google.com/search?q=recursion">recursively</a>. This function has two stop conditions either we reach the end of the string or we run out of allowed differences.
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #e45649;">class</span> <span style="color: #986801;">BWA</span>:
    .
    .
    .
    <span style="color: #e45649;">def</span> <span style="color: #a626a4;">inexact_search</span>(<span style="color: #e45649;">self</span>, read, z):
        <span style="color: #e45649;">self</span>.calculate_diff(read)
        <span style="color: #e45649;">return</span> <span style="color: #e45649;">self</span>.inexact_match(read, <span style="color: #a626a4;">len</span>(read) - <span style="color: #da8548; font-weight: bold;">1</span>, z, <span style="color: #da8548; font-weight: bold;">1</span>, <span style="color: #a626a4;">len</span>(<span style="color: #e45649;">self</span>.last[<span style="color: #da8548; font-weight: bold;">0</span>]) - <span style="color: #da8548; font-weight: bold;">1</span>)


    <span style="color: #e45649;">def</span> <span style="color: #a626a4;">calculate_diff</span>(<span style="color: #e45649;">self</span>, read):
        <span style="color: #84888b; font-style: italic;">'''</span>
<span style="color: #84888b; font-style: italic;">        Estimate the lower bound of allowed z for every character.</span>
<span style="color: #84888b; font-style: italic;">        '''</span>
        <span style="color: #6a1868;">low</span> = <span style="color: #da8548; font-weight: bold;">1</span>
        <span style="color: #6a1868;">high</span> = <span style="color: #a626a4;">len</span>(<span style="color: #e45649;">self</span>.last[<span style="color: #da8548; font-weight: bold;">0</span>]) - <span style="color: #da8548; font-weight: bold;">1</span>
        <span style="color: #6a1868;">diffs</span> = []
        <span style="color: #6a1868;">z</span> = <span style="color: #da8548; font-weight: bold;">0</span>
        <span style="color: #e45649;">for</span> c <span style="color: #e45649;">in</span> read:
            <span style="color: #6a1868;">low</span> = <span style="color: #e45649;">self</span>.lf(c, low - <span style="color: #da8548; font-weight: bold;">1</span>) + <span style="color: #da8548; font-weight: bold;">1</span>
            <span style="color: #6a1868;">high</span> = <span style="color: #e45649;">self</span>.lf(c, high)
            <span style="color: #e45649;">if</span> low &gt; high:
                <span style="color: #6a1868;">low</span> = <span style="color: #da8548; font-weight: bold;">1</span>
                <span style="color: #6a1868;">high</span> = <span style="color: #a626a4;">len</span>(<span style="color: #e45649;">self</span>.last[<span style="color: #da8548; font-weight: bold;">0</span>]) - <span style="color: #da8548; font-weight: bold;">1</span>
                <span style="color: #6a1868;">z</span> +=  <span style="color: #da8548; font-weight: bold;">1</span>
            diffs.append(z)
        <span style="color: #e45649;">self</span>.<span style="color: #6a1868;">diffs</span> = diffs


    <span style="color: #e45649;">def</span> <span style="color: #a626a4;">inexact_match</span>(<span style="color: #e45649;">self</span>, read, i, z, low, high):
        <span style="color: #84888b; font-style: italic;">'''</span>
<span style="color: #84888b; font-style: italic;">        This function has two stop condition. Either we run out of the allowed</span>
<span style="color: #84888b; font-style: italic;">        differences or we find a match.</span>
<span style="color: #84888b; font-style: italic;">        '''</span>
        <span style="color: #e45649;">if</span> z &lt; <span style="color: #e45649;">self</span>.diffs[i]:
            <span style="color: #e45649;">return</span> []
        <span style="color: #e45649;">if</span> i &lt; <span style="color: #da8548; font-weight: bold;">0</span>:
            <span style="color: #e45649;">return</span> [[low,high]]

        <span style="color: #6a1868;">matches</span> = []
        matches.extend(<span style="color: #e45649;">self</span>.inexact_match(read, i - <span style="color: #da8548; font-weight: bold;">1</span>, z - <span style="color: #da8548; font-weight: bold;">1</span>, low, high)) <span style="color: #9ca0a4;"># </span><span style="color: #9ca0a4;">Insertion</span>
        <span style="color: #e45649;">for</span> c <span style="color: #e45649;">in</span> <span style="color: #a626a4;">set</span>(<span style="color: #e45649;">self</span>.last[<span style="color: #da8548; font-weight: bold;">0</span>]):
            <span style="color: #6a1868;">low_</span> = <span style="color: #e45649;">self</span>.lf(c, low - <span style="color: #da8548; font-weight: bold;">1</span>) + <span style="color: #da8548; font-weight: bold;">1</span>
            <span style="color: #6a1868;">high_</span> = <span style="color: #e45649;">self</span>.lf(c, high)
            <span style="color: #e45649;">if</span> low &lt;= high:
                matches.extend(<span style="color: #e45649;">self</span>.inexact_match(read, i, z - <span style="color: #da8548; font-weight: bold;">1</span>, low_, high_)) <span style="color: #9ca0a4;"># </span><span style="color: #9ca0a4;">Deletion</span>
                <span style="color: #e45649;">if</span> c == read[i]:
                    matches.extend(<span style="color: #e45649;">self</span>.inexact_match(read, i - <span style="color: #da8548; font-weight: bold;">1</span>, z, low_, high_)) <span style="color: #9ca0a4;"># </span><span style="color: #9ca0a4;">Match</span>
                <span style="color: #e45649;">else</span>:
                    matches.extend(<span style="color: #e45649;">self</span>.inexact_match(read, i - <span style="color: #da8548; font-weight: bold;">1</span>, z - <span style="color: #da8548; font-weight: bold;">1</span>, low_, high_)) <span style="color: #9ca0a4;"># </span><span style="color: #9ca0a4;">Mismatch</span>
        <span style="color: #e45649;">return</span> matches

</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #6a1868;">example_seq</span>=<span style="color: #50a14f;">"OMICSSBS"</span>
<span style="color: #6a1868;">bwa</span> = BWA(example_seq)
<span style="color: #6a1868;">read</span> = <span style="color: #50a14f;">"OMC"</span>

<span style="color: #6a1868;">matches</span> = bwa.inexact_search(read, <span style="color: #da8548; font-weight: bold;">2</span>)
<span style="color: #a626a4;">print</span>( matches)
<span style="color: #e45649;">for</span> <span style="color: #e45649;">match</span> <span style="color: #e45649;">in</span> matches:
    <span style="color: #6a1868;">low</span>, <span style="color: #6a1868;">high</span> = <span style="color: #e45649;">match</span>
    <span style="color: #6a1868;">initial_ind</span> = bwa.last[<span style="color: #da8548; font-weight: bold;">1</span>][low]
    <span style="color: #a626a4;">print</span>(example_seq[initial_ind:initial_ind + <span style="color: #a626a4;">len</span>(read)])
</pre>
</div>

<pre class="example" id="org8ce08a7">
Hİ 6 [[5, 5], [5, 4], [4, 3], [5, 5], [5, 4], [5, 5]]
OMI
OMI
MIC
OMI
OMI
OMI
</pre>


<label for="sn-symbol" class="sidenote-toggle">⊕</label>
<input type="checkbox" id="sn-symbol" class="sidenote-toggle">
<div class="sidenote" id="org27369e5">
<p>
<b>Visualizing the recursion</b>
</p>

<p>
We can use some help to better visualize the recursion. Lets yank this snippet: <a href="https://github.com/arpitbbhayani/recviz/blob/master/src/recviz/rec.py">https://github.com/arpitbbhayani/recviz/blob/master/src/recviz/rec.py</a> and use a decorator.
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #e45649;">class</span> <span style="color: #986801;">BWA</span>:
    .
    .
    .

    <span style="color: #986801;">@recviz</span>
    <span style="color: #e45649;">def</span> <span style="color: #a626a4;">inexact_match</span>(<span style="color: #e45649;">self</span>, read, i, z, low, high):
        .
        .
        .

</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #6a1868;">example_seq</span>=<span style="color: #50a14f;">"OMICSSBS"</span>
<span style="color: #6a1868;">bwa</span> = BWA(example_seq)
<span style="color: #6a1868;">read</span> = <span style="color: #50a14f;">"OMC"</span>

<span style="color: #6a1868;">matches</span> = bwa.inexact_search(read, <span style="color: #da8548; font-weight: bold;">2</span>)
<span style="color: #a626a4;">print</span>( matches)
<span style="color: #e45649;">for</span> <span style="color: #e45649;">match</span> <span style="color: #e45649;">in</span> matches:
    <span style="color: #6a1868;">low</span>, <span style="color: #6a1868;">high</span> = <span style="color: #e45649;">match</span>
    <span style="color: #6a1868;">initial_ind</span> = bwa.last[<span style="color: #da8548; font-weight: bold;">1</span>][low]
    <span style="color: #a626a4;">print</span>(example_seq[initial_ind:initial_ind + <span style="color: #a626a4;">len</span>(read)])
</pre>
</div>

<pre class="example" id="org822c611">
 -&gt; inexact_match('OMC', 2, 2, 1, 8)
    -&gt; inexact_match('OMC', 1, 1, 1, 8, 'ins')
       -&gt; inexact_match('OMC', 0, 0, 1, 8, 'ins')
          -&gt; inexact_match('OMC', -1, -1, 1, 8, 'ins')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 3, 3, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 3, 3, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 0, 0, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 0, 0, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 7, 8, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 7, 8, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 4, 4, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 4, 4, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 5, 5, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, 0, 5, 5, 'match')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 2, 2, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 2, 2, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 1, 1, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 1, 1, 'missmatch')
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 3, 3, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 0, 0, 3, 3, 'missmatch')
          -&gt; inexact_match('OMC', -1, -1, 3, 3, 'ins')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 4, 3, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 4, 3, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 0, -1, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 0, -1, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 8, 7, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 8, 7, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 4, 4, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 4, 4, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 5, 4, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, 0, 5, 4, 'match')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 2, 1, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 2, 1, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 1, 0, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 1, 0, 'missmatch')
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 0, 0, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 0, 0, 0, 0, 'missmatch')
          -&gt; inexact_match('OMC', -1, -1, 0, 0, 'ins')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 4, 2, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 4, 2, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 1, -1, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 1, -1, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 9, 6, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 9, 6, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 5, 3, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 5, 3, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 6, 4, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, 0, 6, 4, 'match')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 3, 1, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 3, 1, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 2, 0, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 2, 0, 'missmatch')
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 7, 8, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 0, 0, 7, 8, 'missmatch')
          -&gt; inexact_match('OMC', -1, -1, 7, 8, 'ins')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 4, 3, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 4, 3, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 1, 0, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 1, 0, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 8, 8, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 8, 8, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 5, 4, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 5, 4, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 6, 5, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, 0, 6, 5, 'match')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 2, 2, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 2, 2, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 2, 1, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 2, 1, 'missmatch')
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 4, 4, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 0, 1, 4, 4, 'match')
          -&gt; inexact_match('OMC', -1, 0, 4, 4, 'ins')
          &lt;- []
          -&gt; inexact_match('OMC', 0, 0, 4, 3, 'del')
             -&gt; inexact_match('OMC', -1, -1, 4, 3, 'ins')
             &lt;- []
          &lt;- []
          -&gt; inexact_match('OMC', -1, 0, 4, 3, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, 0, 0, -1, 'del')
             -&gt; inexact_match('OMC', -1, -1, 0, -1, 'ins')
             &lt;- []
          &lt;- []
          -&gt; inexact_match('OMC', -1, 0, 0, -1, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, 0, 8, 7, 'del')
             -&gt; inexact_match('OMC', -1, -1, 8, 7, 'ins')
             &lt;- []
          &lt;- []
          -&gt; inexact_match('OMC', -1, 0, 8, 7, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, 0, 5, 4, 'del')
             -&gt; inexact_match('OMC', -1, -1, 5, 4, 'ins')
             &lt;- []
          &lt;- []
          -&gt; inexact_match('OMC', -1, 0, 5, 4, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, 0, 5, 5, 'del')
             -&gt; inexact_match('OMC', -1, -1, 5, 5, 'ins')
             &lt;- []
             -&gt; inexact_match('OMC', 0, -1, 4, 3, 'del')
             &lt;- []
             -&gt; inexact_match('OMC', -1, -1, 4, 3, 'missmatch')
             &lt;- []
             -&gt; inexact_match('OMC', 0, -1, 0, 0, 'del')
             &lt;- []
             -&gt; inexact_match('OMC', -1, -1, 0, 0, 'missmatch')
             &lt;- []
             -&gt; inexact_match('OMC', 0, -1, 8, 7, 'del')
             &lt;- []
             -&gt; inexact_match('OMC', -1, -1, 8, 7, 'missmatch')
             &lt;- []
             -&gt; inexact_match('OMC', 0, -1, 5, 4, 'del')
             &lt;- []
             -&gt; inexact_match('OMC', -1, -1, 5, 4, 'missmatch')
             &lt;- []
             -&gt; inexact_match('OMC', 0, -1, 6, 5, 'del')
             &lt;- []
             -&gt; inexact_match('OMC', -1, 0, 6, 5, 'match')
             &lt;- []
             -&gt; inexact_match('OMC', 0, -1, 2, 1, 'del')
             &lt;- []
             -&gt; inexact_match('OMC', -1, -1, 2, 1, 'missmatch')
             &lt;- []
             -&gt; inexact_match('OMC', 0, -1, 1, 0, 'del')
             &lt;- []
             -&gt; inexact_match('OMC', -1, -1, 1, 0, 'missmatch')
             &lt;- []
          &lt;- []
          -&gt; inexact_match('OMC', -1, 1, 5, 5, 'match')
          &lt;- [[5, 5, 'match']]
          -&gt; inexact_match('OMC', 0, 0, 2, 1, 'del')
             -&gt; inexact_match('OMC', -1, -1, 2, 1, 'ins')
             &lt;- []
          &lt;- []
          -&gt; inexact_match('OMC', -1, 0, 2, 1, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, 0, 1, 0, 'del')
             -&gt; inexact_match('OMC', -1, -1, 1, 0, 'ins')
             &lt;- []
          &lt;- []
          -&gt; inexact_match('OMC', -1, 0, 1, 0, 'missmatch')
          &lt;- []
       &lt;- [[5, 5, 'match']]
       -&gt; inexact_match('OMC', 1, 0, 5, 5, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 0, 0, 5, 5, 'missmatch')
          -&gt; inexact_match('OMC', -1, -1, 5, 5, 'ins')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 4, 3, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 4, 3, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 0, 0, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 0, 0, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 8, 7, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 8, 7, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 5, 4, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 5, 4, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 6, 5, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, 0, 6, 5, 'match')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 2, 1, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 2, 1, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 1, 0, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 1, 0, 'missmatch')
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 2, 2, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 0, 0, 2, 2, 'missmatch')
          -&gt; inexact_match('OMC', -1, -1, 2, 2, 'ins')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 3, 3, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 3, 3, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 0, -1, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 0, -1, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 8, 7, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 8, 7, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 4, 3, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 4, 3, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 5, 4, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, 0, 5, 4, 'match')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 2, 1, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 2, 1, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 1, 0, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 1, 0, 'missmatch')
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 1, 1, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 0, 0, 1, 1, 'missmatch')
          -&gt; inexact_match('OMC', -1, -1, 1, 1, 'ins')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 3, 2, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 3, 2, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 0, -1, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 0, -1, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 7, 7, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 7, 7, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 4, 3, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 4, 3, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 5, 4, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, 0, 5, 4, 'match')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 2, 1, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 2, 1, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 1, 0, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 1, 0, 'missmatch')
          &lt;- []
       &lt;- []
    &lt;- [[5, 5, 'match']]
    -&gt; inexact_match('OMC', 2, 1, 3, 3, 'del')
       -&gt; inexact_match('OMC', 1, 0, 3, 3, 'ins')
       &lt;- []
       -&gt; inexact_match('OMC', 2, 0, 4, 3, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 4, 3, 'missmatch')
       &lt;- []
       -&gt; inexact_match('OMC', 2, 0, 0, -1, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 0, -1, 'missmatch')
       &lt;- []
       -&gt; inexact_match('OMC', 2, 0, 8, 7, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 8, 7, 'missmatch')
       &lt;- []
       -&gt; inexact_match('OMC', 2, 0, 4, 4, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 4, 4, 'missmatch')
       &lt;- []
       -&gt; inexact_match('OMC', 2, 0, 5, 4, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 5, 4, 'missmatch')
       &lt;- []
       -&gt; inexact_match('OMC', 2, 0, 2, 1, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 1, 1, 2, 1, 'match')
          -&gt; inexact_match('OMC', 0, 0, 2, 1, 'ins')
             -&gt; inexact_match('OMC', -1, -1, 2, 1, 'ins')
             &lt;- []
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 2, 0, 1, 0, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 1, 0, 'missmatch')
       &lt;- []
    &lt;- []
    -&gt; inexact_match('OMC', 1, 1, 3, 3, 'missmatch')
       -&gt; inexact_match('OMC', 0, 0, 3, 3, 'ins')
          -&gt; inexact_match('OMC', -1, -1, 3, 3, 'ins')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 4, 3, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 4, 3, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 0, -1, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 0, -1, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 8, 7, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 8, 7, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 4, 4, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 4, 4, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 5, 4, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, 0, 5, 4, 'match')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 2, 1, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 2, 1, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 1, 0, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 1, 0, 'missmatch')
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 4, 3, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 0, 0, 4, 3, 'missmatch')
          -&gt; inexact_match('OMC', -1, -1, 4, 3, 'ins')
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 0, -1, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 0, 0, 0, -1, 'missmatch')
          -&gt; inexact_match('OMC', -1, -1, 0, -1, 'ins')
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 8, 7, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 0, 0, 8, 7, 'missmatch')
          -&gt; inexact_match('OMC', -1, -1, 8, 7, 'ins')
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 4, 4, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 0, 1, 4, 4, 'match')
          -&gt; inexact_match('OMC', -1, 0, 4, 4, 'ins')
          &lt;- []
          -&gt; inexact_match('OMC', 0, 0, 4, 3, 'del')
             -&gt; inexact_match('OMC', -1, -1, 4, 3, 'ins')
             &lt;- []
          &lt;- []
          -&gt; inexact_match('OMC', -1, 0, 4, 3, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, 0, 0, -1, 'del')
             -&gt; inexact_match('OMC', -1, -1, 0, -1, 'ins')
             &lt;- []
          &lt;- []
          -&gt; inexact_match('OMC', -1, 0, 0, -1, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, 0, 8, 7, 'del')
             -&gt; inexact_match('OMC', -1, -1, 8, 7, 'ins')
             &lt;- []
          &lt;- []
          -&gt; inexact_match('OMC', -1, 0, 8, 7, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, 0, 5, 4, 'del')
             -&gt; inexact_match('OMC', -1, -1, 5, 4, 'ins')
             &lt;- []
          &lt;- []
          -&gt; inexact_match('OMC', -1, 0, 5, 4, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, 0, 5, 5, 'del')
             -&gt; inexact_match('OMC', -1, -1, 5, 5, 'ins')
             &lt;- []
             -&gt; inexact_match('OMC', 0, -1, 4, 3, 'del')
             &lt;- []
             -&gt; inexact_match('OMC', -1, -1, 4, 3, 'missmatch')
             &lt;- []
             -&gt; inexact_match('OMC', 0, -1, 0, 0, 'del')
             &lt;- []
             -&gt; inexact_match('OMC', -1, -1, 0, 0, 'missmatch')
             &lt;- []
             -&gt; inexact_match('OMC', 0, -1, 8, 7, 'del')
             &lt;- []
             -&gt; inexact_match('OMC', -1, -1, 8, 7, 'missmatch')
             &lt;- []
             -&gt; inexact_match('OMC', 0, -1, 5, 4, 'del')
             &lt;- []
             -&gt; inexact_match('OMC', -1, -1, 5, 4, 'missmatch')
             &lt;- []
             -&gt; inexact_match('OMC', 0, -1, 6, 5, 'del')
             &lt;- []
             -&gt; inexact_match('OMC', -1, 0, 6, 5, 'match')
             &lt;- []
             -&gt; inexact_match('OMC', 0, -1, 2, 1, 'del')
             &lt;- []
             -&gt; inexact_match('OMC', -1, -1, 2, 1, 'missmatch')
             &lt;- []
             -&gt; inexact_match('OMC', 0, -1, 1, 0, 'del')
             &lt;- []
             -&gt; inexact_match('OMC', -1, -1, 1, 0, 'missmatch')
             &lt;- []
          &lt;- []
          -&gt; inexact_match('OMC', -1, 1, 5, 5, 'match')
          &lt;- [[5, 5, 'match']]
          -&gt; inexact_match('OMC', 0, 0, 2, 1, 'del')
             -&gt; inexact_match('OMC', -1, -1, 2, 1, 'ins')
             &lt;- []
          &lt;- []
          -&gt; inexact_match('OMC', -1, 0, 2, 1, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, 0, 1, 0, 'del')
             -&gt; inexact_match('OMC', -1, -1, 1, 0, 'ins')
             &lt;- []
          &lt;- []
          -&gt; inexact_match('OMC', -1, 0, 1, 0, 'missmatch')
          &lt;- []
       &lt;- [[5, 5, 'match']]
       -&gt; inexact_match('OMC', 1, 0, 5, 4, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 0, 0, 5, 4, 'missmatch')
          -&gt; inexact_match('OMC', -1, -1, 5, 4, 'ins')
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 2, 1, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 0, 0, 2, 1, 'missmatch')
          -&gt; inexact_match('OMC', -1, -1, 2, 1, 'ins')
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 1, 0, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 0, 0, 1, 0, 'missmatch')
          -&gt; inexact_match('OMC', -1, -1, 1, 0, 'ins')
          &lt;- []
       &lt;- []
    &lt;- [[5, 5, 'match']]
    -&gt; inexact_match('OMC', 2, 1, 0, 0, 'del')
       -&gt; inexact_match('OMC', 1, 0, 0, 0, 'ins')
       &lt;- []
       -&gt; inexact_match('OMC', 2, 0, 4, 2, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 4, 2, 'missmatch')
       &lt;- []
       -&gt; inexact_match('OMC', 2, 0, 1, -1, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 1, -1, 'missmatch')
       &lt;- []
       -&gt; inexact_match('OMC', 2, 0, 9, 6, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 9, 6, 'missmatch')
       &lt;- []
       -&gt; inexact_match('OMC', 2, 0, 5, 3, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 5, 3, 'missmatch')
       &lt;- []
       -&gt; inexact_match('OMC', 2, 0, 6, 4, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 6, 4, 'missmatch')
       &lt;- []
       -&gt; inexact_match('OMC', 2, 0, 3, 1, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 1, 1, 3, 1, 'match')
          -&gt; inexact_match('OMC', 0, 0, 3, 1, 'ins')
             -&gt; inexact_match('OMC', -1, -1, 3, 1, 'ins')
             &lt;- []
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 2, 0, 2, 0, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 2, 0, 'missmatch')
       &lt;- []
    &lt;- []
    -&gt; inexact_match('OMC', 1, 1, 0, 0, 'missmatch')
       -&gt; inexact_match('OMC', 0, 0, 0, 0, 'ins')
          -&gt; inexact_match('OMC', -1, -1, 0, 0, 'ins')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 4, 2, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 4, 2, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 1, -1, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 1, -1, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 9, 6, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 9, 6, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 5, 3, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 5, 3, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 6, 4, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, 0, 6, 4, 'match')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 3, 1, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 3, 1, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 2, 0, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 2, 0, 'missmatch')
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 4, 2, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 0, 0, 4, 2, 'missmatch')
          -&gt; inexact_match('OMC', -1, -1, 4, 2, 'ins')
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 1, -1, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 0, 0, 1, -1, 'missmatch')
          -&gt; inexact_match('OMC', -1, -1, 1, -1, 'ins')
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 9, 6, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 0, 0, 9, 6, 'missmatch')
          -&gt; inexact_match('OMC', -1, -1, 9, 6, 'ins')
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 5, 3, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 0, 1, 5, 3, 'match')
          -&gt; inexact_match('OMC', -1, 0, 5, 3, 'ins')
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 6, 4, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 0, 0, 6, 4, 'missmatch')
          -&gt; inexact_match('OMC', -1, -1, 6, 4, 'ins')
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 3, 1, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 0, 0, 3, 1, 'missmatch')
          -&gt; inexact_match('OMC', -1, -1, 3, 1, 'ins')
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 2, 0, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 0, 0, 2, 0, 'missmatch')
          -&gt; inexact_match('OMC', -1, -1, 2, 0, 'ins')
          &lt;- []
       &lt;- []
    &lt;- []
    -&gt; inexact_match('OMC', 2, 1, 7, 8, 'del')
       -&gt; inexact_match('OMC', 1, 0, 7, 8, 'ins')
       &lt;- []
       -&gt; inexact_match('OMC', 2, 0, 4, 3, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 4, 3, 'missmatch')
       &lt;- []
       -&gt; inexact_match('OMC', 2, 0, 1, 0, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 1, 0, 'missmatch')
       &lt;- []
       -&gt; inexact_match('OMC', 2, 0, 8, 8, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 8, 8, 'missmatch')
       &lt;- []
       -&gt; inexact_match('OMC', 2, 0, 5, 4, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 5, 4, 'missmatch')
       &lt;- []
       -&gt; inexact_match('OMC', 2, 0, 6, 5, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 6, 5, 'missmatch')
       &lt;- []
       -&gt; inexact_match('OMC', 2, 0, 2, 2, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 1, 1, 2, 2, 'match')
          -&gt; inexact_match('OMC', 0, 0, 2, 2, 'ins')
             -&gt; inexact_match('OMC', -1, -1, 2, 2, 'ins')
             &lt;- []
             -&gt; inexact_match('OMC', 0, -1, 3, 3, 'del')
             &lt;- []
             -&gt; inexact_match('OMC', -1, -1, 3, 3, 'missmatch')
             &lt;- []
             -&gt; inexact_match('OMC', 0, -1, 0, -1, 'del')
             &lt;- []
             -&gt; inexact_match('OMC', -1, -1, 0, -1, 'missmatch')
             &lt;- []
             -&gt; inexact_match('OMC', 0, -1, 8, 7, 'del')
             &lt;- []
             -&gt; inexact_match('OMC', -1, -1, 8, 7, 'missmatch')
             &lt;- []
             -&gt; inexact_match('OMC', 0, -1, 4, 3, 'del')
             &lt;- []
             -&gt; inexact_match('OMC', -1, -1, 4, 3, 'missmatch')
             &lt;- []
             -&gt; inexact_match('OMC', 0, -1, 5, 4, 'del')
             &lt;- []
             -&gt; inexact_match('OMC', -1, 0, 5, 4, 'match')
             &lt;- []
             -&gt; inexact_match('OMC', 0, -1, 2, 1, 'del')
             &lt;- []
             -&gt; inexact_match('OMC', -1, -1, 2, 1, 'missmatch')
             &lt;- []
             -&gt; inexact_match('OMC', 0, -1, 1, 0, 'del')
             &lt;- []
             -&gt; inexact_match('OMC', -1, -1, 1, 0, 'missmatch')
             &lt;- []
          &lt;- []
          -&gt; inexact_match('OMC', 1, 0, 3, 3, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', 0, 0, 3, 3, 'missmatch')
             -&gt; inexact_match('OMC', -1, -1, 3, 3, 'ins')
             &lt;- []
             -&gt; inexact_match('OMC', 0, -1, 4, 3, 'del')
             &lt;- []
             -&gt; inexact_match('OMC', -1, -1, 4, 3, 'missmatch')
             &lt;- []
             -&gt; inexact_match('OMC', 0, -1, 0, -1, 'del')
             &lt;- []
             -&gt; inexact_match('OMC', -1, -1, 0, -1, 'missmatch')
             &lt;- []
             -&gt; inexact_match('OMC', 0, -1, 8, 7, 'del')
             &lt;- []
             -&gt; inexact_match('OMC', -1, -1, 8, 7, 'missmatch')
             &lt;- []
             -&gt; inexact_match('OMC', 0, -1, 4, 4, 'del')
             &lt;- []
             -&gt; inexact_match('OMC', -1, -1, 4, 4, 'missmatch')
             &lt;- []
             -&gt; inexact_match('OMC', 0, -1, 5, 4, 'del')
             &lt;- []
             -&gt; inexact_match('OMC', -1, 0, 5, 4, 'match')
             &lt;- []
             -&gt; inexact_match('OMC', 0, -1, 2, 1, 'del')
             &lt;- []
             -&gt; inexact_match('OMC', -1, -1, 2, 1, 'missmatch')
             &lt;- []
             -&gt; inexact_match('OMC', 0, -1, 1, 0, 'del')
             &lt;- []
             -&gt; inexact_match('OMC', -1, -1, 1, 0, 'missmatch')
             &lt;- []
          &lt;- []
          -&gt; inexact_match('OMC', 1, 0, 0, -1, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', 0, 0, 0, -1, 'missmatch')
             -&gt; inexact_match('OMC', -1, -1, 0, -1, 'ins')
             &lt;- []
          &lt;- []
          -&gt; inexact_match('OMC', 1, 0, 8, 7, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', 0, 0, 8, 7, 'missmatch')
             -&gt; inexact_match('OMC', -1, -1, 8, 7, 'ins')
             &lt;- []
          &lt;- []
          -&gt; inexact_match('OMC', 1, 0, 4, 3, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', 0, 1, 4, 3, 'match')
             -&gt; inexact_match('OMC', -1, 0, 4, 3, 'ins')
             &lt;- []
          &lt;- []
          -&gt; inexact_match('OMC', 1, 0, 5, 4, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', 0, 0, 5, 4, 'missmatch')
             -&gt; inexact_match('OMC', -1, -1, 5, 4, 'ins')
             &lt;- []
          &lt;- []
          -&gt; inexact_match('OMC', 1, 0, 2, 1, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', 0, 0, 2, 1, 'missmatch')
             -&gt; inexact_match('OMC', -1, -1, 2, 1, 'ins')
             &lt;- []
          &lt;- []
          -&gt; inexact_match('OMC', 1, 0, 1, 0, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', 0, 0, 1, 0, 'missmatch')
             -&gt; inexact_match('OMC', -1, -1, 1, 0, 'ins')
             &lt;- []
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 2, 0, 2, 1, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 2, 1, 'missmatch')
       &lt;- []
    &lt;- []
    -&gt; inexact_match('OMC', 1, 1, 7, 8, 'missmatch')
       -&gt; inexact_match('OMC', 0, 0, 7, 8, 'ins')
          -&gt; inexact_match('OMC', -1, -1, 7, 8, 'ins')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 4, 3, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 4, 3, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 1, 0, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 1, 0, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 8, 8, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 8, 8, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 5, 4, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 5, 4, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 6, 5, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, 0, 6, 5, 'match')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 2, 2, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 2, 2, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 2, 1, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 2, 1, 'missmatch')
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 4, 3, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 0, 0, 4, 3, 'missmatch')
          -&gt; inexact_match('OMC', -1, -1, 4, 3, 'ins')
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 1, 0, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 0, 0, 1, 0, 'missmatch')
          -&gt; inexact_match('OMC', -1, -1, 1, 0, 'ins')
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 8, 8, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 0, 0, 8, 8, 'missmatch')
          -&gt; inexact_match('OMC', -1, -1, 8, 8, 'ins')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 4, 3, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 4, 3, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 1, 0, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 1, 0, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 9, 8, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 9, 8, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 5, 4, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 5, 4, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 6, 5, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, 0, 6, 5, 'match')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 2, 2, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 2, 2, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 2, 1, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 2, 1, 'missmatch')
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 5, 4, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 0, 1, 5, 4, 'match')
          -&gt; inexact_match('OMC', -1, 0, 5, 4, 'ins')
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 6, 5, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 0, 0, 6, 5, 'missmatch')
          -&gt; inexact_match('OMC', -1, -1, 6, 5, 'ins')
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 2, 2, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 0, 0, 2, 2, 'missmatch')
          -&gt; inexact_match('OMC', -1, -1, 2, 2, 'ins')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 3, 3, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 3, 3, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 0, -1, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 0, -1, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 8, 7, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 8, 7, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 4, 3, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 4, 3, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 5, 4, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, 0, 5, 4, 'match')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 2, 1, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 2, 1, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 1, 0, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 1, 0, 'missmatch')
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 2, 1, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 0, 0, 2, 1, 'missmatch')
          -&gt; inexact_match('OMC', -1, -1, 2, 1, 'ins')
          &lt;- []
       &lt;- []
    &lt;- []
    -&gt; inexact_match('OMC', 2, 1, 4, 4, 'del')
       -&gt; inexact_match('OMC', 1, 0, 4, 4, 'ins')
       &lt;- []
       -&gt; inexact_match('OMC', 2, 0, 4, 3, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 4, 3, 'missmatch')
       &lt;- []
       -&gt; inexact_match('OMC', 2, 0, 0, -1, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 0, -1, 'missmatch')
       &lt;- []
       -&gt; inexact_match('OMC', 2, 0, 8, 7, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 8, 7, 'missmatch')
       &lt;- []
       -&gt; inexact_match('OMC', 2, 0, 5, 4, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 5, 4, 'missmatch')
       &lt;- []
       -&gt; inexact_match('OMC', 2, 0, 5, 5, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 5, 5, 'missmatch')
       &lt;- []
       -&gt; inexact_match('OMC', 2, 0, 2, 1, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 1, 1, 2, 1, 'match')
          -&gt; inexact_match('OMC', 0, 0, 2, 1, 'ins')
             -&gt; inexact_match('OMC', -1, -1, 2, 1, 'ins')
             &lt;- []
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 2, 0, 1, 0, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 1, 0, 'missmatch')
       &lt;- []
    &lt;- []
    -&gt; inexact_match('OMC', 1, 1, 4, 4, 'missmatch')
       -&gt; inexact_match('OMC', 0, 0, 4, 4, 'ins')
          -&gt; inexact_match('OMC', -1, -1, 4, 4, 'ins')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 4, 3, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 4, 3, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 0, -1, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 0, -1, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 8, 7, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 8, 7, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 5, 4, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 5, 4, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 5, 5, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, 0, 5, 5, 'match')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 2, 1, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 2, 1, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 1, 0, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 1, 0, 'missmatch')
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 4, 3, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 0, 0, 4, 3, 'missmatch')
          -&gt; inexact_match('OMC', -1, -1, 4, 3, 'ins')
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 0, -1, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 0, 0, 0, -1, 'missmatch')
          -&gt; inexact_match('OMC', -1, -1, 0, -1, 'ins')
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 8, 7, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 0, 0, 8, 7, 'missmatch')
          -&gt; inexact_match('OMC', -1, -1, 8, 7, 'ins')
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 5, 4, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 0, 1, 5, 4, 'match')
          -&gt; inexact_match('OMC', -1, 0, 5, 4, 'ins')
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 5, 5, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 0, 0, 5, 5, 'missmatch')
          -&gt; inexact_match('OMC', -1, -1, 5, 5, 'ins')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 4, 3, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 4, 3, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 0, 0, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 0, 0, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 8, 7, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 8, 7, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 5, 4, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 5, 4, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 6, 5, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, 0, 6, 5, 'match')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 2, 1, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 2, 1, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 1, 0, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 1, 0, 'missmatch')
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 2, 1, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 0, 0, 2, 1, 'missmatch')
          -&gt; inexact_match('OMC', -1, -1, 2, 1, 'ins')
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 1, 0, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 0, 0, 1, 0, 'missmatch')
          -&gt; inexact_match('OMC', -1, -1, 1, 0, 'ins')
          &lt;- []
       &lt;- []
    &lt;- []
    -&gt; inexact_match('OMC', 2, 1, 5, 5, 'del')
       -&gt; inexact_match('OMC', 1, 0, 5, 5, 'ins')
       &lt;- []
       -&gt; inexact_match('OMC', 2, 0, 4, 3, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 4, 3, 'missmatch')
       &lt;- []
       -&gt; inexact_match('OMC', 2, 0, 0, 0, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 0, 0, 'missmatch')
       &lt;- []
       -&gt; inexact_match('OMC', 2, 0, 8, 7, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 8, 7, 'missmatch')
       &lt;- []
       -&gt; inexact_match('OMC', 2, 0, 5, 4, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 5, 4, 'missmatch')
       &lt;- []
       -&gt; inexact_match('OMC', 2, 0, 6, 5, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 6, 5, 'missmatch')
       &lt;- []
       -&gt; inexact_match('OMC', 2, 0, 2, 1, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 1, 1, 2, 1, 'match')
          -&gt; inexact_match('OMC', 0, 0, 2, 1, 'ins')
             -&gt; inexact_match('OMC', -1, -1, 2, 1, 'ins')
             &lt;- []
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 2, 0, 1, 0, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 1, 0, 'missmatch')
       &lt;- []
    &lt;- []
    -&gt; inexact_match('OMC', 1, 1, 5, 5, 'missmatch')
       -&gt; inexact_match('OMC', 0, 0, 5, 5, 'ins')
          -&gt; inexact_match('OMC', -1, -1, 5, 5, 'ins')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 4, 3, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 4, 3, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 0, 0, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 0, 0, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 8, 7, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 8, 7, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 5, 4, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 5, 4, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 6, 5, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, 0, 6, 5, 'match')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 2, 1, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 2, 1, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 1, 0, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 1, 0, 'missmatch')
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 4, 3, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 0, 0, 4, 3, 'missmatch')
          -&gt; inexact_match('OMC', -1, -1, 4, 3, 'ins')
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 0, 0, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 0, 0, 0, 0, 'missmatch')
          -&gt; inexact_match('OMC', -1, -1, 0, 0, 'ins')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 4, 2, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 4, 2, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 1, -1, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 1, -1, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 9, 6, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 9, 6, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 5, 3, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 5, 3, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 6, 4, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, 0, 6, 4, 'match')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 3, 1, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 3, 1, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 2, 0, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 2, 0, 'missmatch')
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 8, 7, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 0, 0, 8, 7, 'missmatch')
          -&gt; inexact_match('OMC', -1, -1, 8, 7, 'ins')
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 5, 4, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 0, 1, 5, 4, 'match')
          -&gt; inexact_match('OMC', -1, 0, 5, 4, 'ins')
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 6, 5, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 0, 0, 6, 5, 'missmatch')
          -&gt; inexact_match('OMC', -1, -1, 6, 5, 'ins')
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 2, 1, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 0, 0, 2, 1, 'missmatch')
          -&gt; inexact_match('OMC', -1, -1, 2, 1, 'ins')
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 1, 0, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 0, 0, 1, 0, 'missmatch')
          -&gt; inexact_match('OMC', -1, -1, 1, 0, 'ins')
          &lt;- []
       &lt;- []
    &lt;- []
    -&gt; inexact_match('OMC', 2, 1, 2, 2, 'del')
       -&gt; inexact_match('OMC', 1, 0, 2, 2, 'ins')
       &lt;- []
       -&gt; inexact_match('OMC', 2, 0, 3, 3, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 3, 3, 'missmatch')
       &lt;- []
       -&gt; inexact_match('OMC', 2, 0, 0, -1, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 0, -1, 'missmatch')
       &lt;- []
       -&gt; inexact_match('OMC', 2, 0, 8, 7, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 8, 7, 'missmatch')
       &lt;- []
       -&gt; inexact_match('OMC', 2, 0, 4, 3, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 4, 3, 'missmatch')
       &lt;- []
       -&gt; inexact_match('OMC', 2, 0, 5, 4, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 5, 4, 'missmatch')
       &lt;- []
       -&gt; inexact_match('OMC', 2, 0, 2, 1, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 1, 1, 2, 1, 'match')
          -&gt; inexact_match('OMC', 0, 0, 2, 1, 'ins')
             -&gt; inexact_match('OMC', -1, -1, 2, 1, 'ins')
             &lt;- []
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 2, 0, 1, 0, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 1, 0, 'missmatch')
       &lt;- []
    &lt;- []
    -&gt; inexact_match('OMC', 1, 2, 2, 2, 'match')
       -&gt; inexact_match('OMC', 0, 1, 2, 2, 'ins')
          -&gt; inexact_match('OMC', -1, 0, 2, 2, 'ins')
          &lt;- []
          -&gt; inexact_match('OMC', 0, 0, 3, 3, 'del')
             -&gt; inexact_match('OMC', -1, -1, 3, 3, 'ins')
             &lt;- []
             -&gt; inexact_match('OMC', 0, -1, 4, 3, 'del')
             &lt;- []
             -&gt; inexact_match('OMC', -1, -1, 4, 3, 'missmatch')
             &lt;- []
             -&gt; inexact_match('OMC', 0, -1, 0, -1, 'del')
             &lt;- []
             -&gt; inexact_match('OMC', -1, -1, 0, -1, 'missmatch')
             &lt;- []
             -&gt; inexact_match('OMC', 0, -1, 8, 7, 'del')
             &lt;- []
             -&gt; inexact_match('OMC', -1, -1, 8, 7, 'missmatch')
             &lt;- []
             -&gt; inexact_match('OMC', 0, -1, 4, 4, 'del')
             &lt;- []
             -&gt; inexact_match('OMC', -1, -1, 4, 4, 'missmatch')
             &lt;- []
             -&gt; inexact_match('OMC', 0, -1, 5, 4, 'del')
             &lt;- []
             -&gt; inexact_match('OMC', -1, 0, 5, 4, 'match')
             &lt;- []
             -&gt; inexact_match('OMC', 0, -1, 2, 1, 'del')
             &lt;- []
             -&gt; inexact_match('OMC', -1, -1, 2, 1, 'missmatch')
             &lt;- []
             -&gt; inexact_match('OMC', 0, -1, 1, 0, 'del')
             &lt;- []
             -&gt; inexact_match('OMC', -1, -1, 1, 0, 'missmatch')
             &lt;- []
          &lt;- []
          -&gt; inexact_match('OMC', -1, 0, 3, 3, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, 0, 0, -1, 'del')
             -&gt; inexact_match('OMC', -1, -1, 0, -1, 'ins')
             &lt;- []
          &lt;- []
          -&gt; inexact_match('OMC', -1, 0, 0, -1, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, 0, 8, 7, 'del')
             -&gt; inexact_match('OMC', -1, -1, 8, 7, 'ins')
             &lt;- []
          &lt;- []
          -&gt; inexact_match('OMC', -1, 0, 8, 7, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, 0, 4, 3, 'del')
             -&gt; inexact_match('OMC', -1, -1, 4, 3, 'ins')
             &lt;- []
          &lt;- []
          -&gt; inexact_match('OMC', -1, 0, 4, 3, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, 0, 5, 4, 'del')
             -&gt; inexact_match('OMC', -1, -1, 5, 4, 'ins')
             &lt;- []
          &lt;- []
          -&gt; inexact_match('OMC', -1, 1, 5, 4, 'match')
          &lt;- [[5, 4, 'match']]
          -&gt; inexact_match('OMC', 0, 0, 2, 1, 'del')
             -&gt; inexact_match('OMC', -1, -1, 2, 1, 'ins')
             &lt;- []
          &lt;- []
          -&gt; inexact_match('OMC', -1, 0, 2, 1, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, 0, 1, 0, 'del')
             -&gt; inexact_match('OMC', -1, -1, 1, 0, 'ins')
             &lt;- []
          &lt;- []
          -&gt; inexact_match('OMC', -1, 0, 1, 0, 'missmatch')
          &lt;- []
       &lt;- [[5, 4, 'match']]
       -&gt; inexact_match('OMC', 1, 1, 3, 3, 'del')
          -&gt; inexact_match('OMC', 0, 0, 3, 3, 'ins')
             -&gt; inexact_match('OMC', -1, -1, 3, 3, 'ins')
             &lt;- []
             -&gt; inexact_match('OMC', 0, -1, 4, 3, 'del')
             &lt;- []
             -&gt; inexact_match('OMC', -1, -1, 4, 3, 'missmatch')
             &lt;- []
             -&gt; inexact_match('OMC', 0, -1, 0, -1, 'del')
             &lt;- []
             -&gt; inexact_match('OMC', -1, -1, 0, -1, 'missmatch')
             &lt;- []
             -&gt; inexact_match('OMC', 0, -1, 8, 7, 'del')
             &lt;- []
             -&gt; inexact_match('OMC', -1, -1, 8, 7, 'missmatch')
             &lt;- []
             -&gt; inexact_match('OMC', 0, -1, 4, 4, 'del')
             &lt;- []
             -&gt; inexact_match('OMC', -1, -1, 4, 4, 'missmatch')
             &lt;- []
             -&gt; inexact_match('OMC', 0, -1, 5, 4, 'del')
             &lt;- []
             -&gt; inexact_match('OMC', -1, 0, 5, 4, 'match')
             &lt;- []
             -&gt; inexact_match('OMC', 0, -1, 2, 1, 'del')
             &lt;- []
             -&gt; inexact_match('OMC', -1, -1, 2, 1, 'missmatch')
             &lt;- []
             -&gt; inexact_match('OMC', 0, -1, 1, 0, 'del')
             &lt;- []
             -&gt; inexact_match('OMC', -1, -1, 1, 0, 'missmatch')
             &lt;- []
          &lt;- []
          -&gt; inexact_match('OMC', 1, 0, 4, 3, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', 0, 0, 4, 3, 'missmatch')
             -&gt; inexact_match('OMC', -1, -1, 4, 3, 'ins')
             &lt;- []
          &lt;- []
          -&gt; inexact_match('OMC', 1, 0, 0, -1, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', 0, 0, 0, -1, 'missmatch')
             -&gt; inexact_match('OMC', -1, -1, 0, -1, 'ins')
             &lt;- []
          &lt;- []
          -&gt; inexact_match('OMC', 1, 0, 8, 7, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', 0, 0, 8, 7, 'missmatch')
             -&gt; inexact_match('OMC', -1, -1, 8, 7, 'ins')
             &lt;- []
          &lt;- []
          -&gt; inexact_match('OMC', 1, 0, 4, 4, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', 0, 1, 4, 4, 'match')
             -&gt; inexact_match('OMC', -1, 0, 4, 4, 'ins')
             &lt;- []
             -&gt; inexact_match('OMC', 0, 0, 4, 3, 'del')
                -&gt; inexact_match('OMC', -1, -1, 4, 3, 'ins')
                &lt;- []
             &lt;- []
             -&gt; inexact_match('OMC', -1, 0, 4, 3, 'missmatch')
             &lt;- []
             -&gt; inexact_match('OMC', 0, 0, 0, -1, 'del')
                -&gt; inexact_match('OMC', -1, -1, 0, -1, 'ins')
                &lt;- []
             &lt;- []
             -&gt; inexact_match('OMC', -1, 0, 0, -1, 'missmatch')
             &lt;- []
             -&gt; inexact_match('OMC', 0, 0, 8, 7, 'del')
                -&gt; inexact_match('OMC', -1, -1, 8, 7, 'ins')
                &lt;- []
             &lt;- []
             -&gt; inexact_match('OMC', -1, 0, 8, 7, 'missmatch')
             &lt;- []
             -&gt; inexact_match('OMC', 0, 0, 5, 4, 'del')
                -&gt; inexact_match('OMC', -1, -1, 5, 4, 'ins')
                &lt;- []
             &lt;- []
             -&gt; inexact_match('OMC', -1, 0, 5, 4, 'missmatch')
             &lt;- []
             -&gt; inexact_match('OMC', 0, 0, 5, 5, 'del')
                -&gt; inexact_match('OMC', -1, -1, 5, 5, 'ins')
                &lt;- []
                -&gt; inexact_match('OMC', 0, -1, 4, 3, 'del')
                &lt;- []
                -&gt; inexact_match('OMC', -1, -1, 4, 3, 'missmatch')
                &lt;- []
                -&gt; inexact_match('OMC', 0, -1, 0, 0, 'del')
                &lt;- []
                -&gt; inexact_match('OMC', -1, -1, 0, 0, 'missmatch')
                &lt;- []
                -&gt; inexact_match('OMC', 0, -1, 8, 7, 'del')
                &lt;- []
                -&gt; inexact_match('OMC', -1, -1, 8, 7, 'missmatch')
                &lt;- []
                -&gt; inexact_match('OMC', 0, -1, 5, 4, 'del')
                &lt;- []
                -&gt; inexact_match('OMC', -1, -1, 5, 4, 'missmatch')
                &lt;- []
                -&gt; inexact_match('OMC', 0, -1, 6, 5, 'del')
                &lt;- []
                -&gt; inexact_match('OMC', -1, 0, 6, 5, 'match')
                &lt;- []
                -&gt; inexact_match('OMC', 0, -1, 2, 1, 'del')
                &lt;- []
                -&gt; inexact_match('OMC', -1, -1, 2, 1, 'missmatch')
                &lt;- []
                -&gt; inexact_match('OMC', 0, -1, 1, 0, 'del')
                &lt;- []
                -&gt; inexact_match('OMC', -1, -1, 1, 0, 'missmatch')
                &lt;- []
             &lt;- []
             -&gt; inexact_match('OMC', -1, 1, 5, 5, 'match')
             &lt;- [[5, 5, 'match']]
             -&gt; inexact_match('OMC', 0, 0, 2, 1, 'del')
                -&gt; inexact_match('OMC', -1, -1, 2, 1, 'ins')
                &lt;- []
             &lt;- []
             -&gt; inexact_match('OMC', -1, 0, 2, 1, 'missmatch')
             &lt;- []
             -&gt; inexact_match('OMC', 0, 0, 1, 0, 'del')
                -&gt; inexact_match('OMC', -1, -1, 1, 0, 'ins')
                &lt;- []
             &lt;- []
             -&gt; inexact_match('OMC', -1, 0, 1, 0, 'missmatch')
             &lt;- []
          &lt;- [[5, 5, 'match']]
          -&gt; inexact_match('OMC', 1, 0, 5, 4, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', 0, 0, 5, 4, 'missmatch')
             -&gt; inexact_match('OMC', -1, -1, 5, 4, 'ins')
             &lt;- []
          &lt;- []
          -&gt; inexact_match('OMC', 1, 0, 2, 1, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', 0, 0, 2, 1, 'missmatch')
             -&gt; inexact_match('OMC', -1, -1, 2, 1, 'ins')
             &lt;- []
          &lt;- []
          -&gt; inexact_match('OMC', 1, 0, 1, 0, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', 0, 0, 1, 0, 'missmatch')
             -&gt; inexact_match('OMC', -1, -1, 1, 0, 'ins')
             &lt;- []
          &lt;- []
       &lt;- [[5, 5, 'match']]
       -&gt; inexact_match('OMC', 0, 1, 3, 3, 'missmatch')
          -&gt; inexact_match('OMC', -1, 0, 3, 3, 'ins')
          &lt;- []
          -&gt; inexact_match('OMC', 0, 0, 4, 3, 'del')
             -&gt; inexact_match('OMC', -1, -1, 4, 3, 'ins')
             &lt;- []
          &lt;- []
          -&gt; inexact_match('OMC', -1, 0, 4, 3, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, 0, 0, -1, 'del')
             -&gt; inexact_match('OMC', -1, -1, 0, -1, 'ins')
             &lt;- []
          &lt;- []
          -&gt; inexact_match('OMC', -1, 0, 0, -1, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, 0, 8, 7, 'del')
             -&gt; inexact_match('OMC', -1, -1, 8, 7, 'ins')
             &lt;- []
          &lt;- []
          -&gt; inexact_match('OMC', -1, 0, 8, 7, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, 0, 4, 4, 'del')
             -&gt; inexact_match('OMC', -1, -1, 4, 4, 'ins')
             &lt;- []
             -&gt; inexact_match('OMC', 0, -1, 4, 3, 'del')
             &lt;- []
             -&gt; inexact_match('OMC', -1, -1, 4, 3, 'missmatch')
             &lt;- []
             -&gt; inexact_match('OMC', 0, -1, 0, -1, 'del')
             &lt;- []
             -&gt; inexact_match('OMC', -1, -1, 0, -1, 'missmatch')
             &lt;- []
             -&gt; inexact_match('OMC', 0, -1, 8, 7, 'del')
             &lt;- []
             -&gt; inexact_match('OMC', -1, -1, 8, 7, 'missmatch')
             &lt;- []
             -&gt; inexact_match('OMC', 0, -1, 5, 4, 'del')
             &lt;- []
             -&gt; inexact_match('OMC', -1, -1, 5, 4, 'missmatch')
             &lt;- []
             -&gt; inexact_match('OMC', 0, -1, 5, 5, 'del')
             &lt;- []
             -&gt; inexact_match('OMC', -1, 0, 5, 5, 'match')
             &lt;- []
             -&gt; inexact_match('OMC', 0, -1, 2, 1, 'del')
             &lt;- []
             -&gt; inexact_match('OMC', -1, -1, 2, 1, 'missmatch')
             &lt;- []
             -&gt; inexact_match('OMC', 0, -1, 1, 0, 'del')
             &lt;- []
             -&gt; inexact_match('OMC', -1, -1, 1, 0, 'missmatch')
             &lt;- []
          &lt;- []
          -&gt; inexact_match('OMC', -1, 0, 4, 4, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, 0, 5, 4, 'del')
             -&gt; inexact_match('OMC', -1, -1, 5, 4, 'ins')
             &lt;- []
          &lt;- []
          -&gt; inexact_match('OMC', -1, 1, 5, 4, 'match')
          &lt;- [[5, 4, 'match']]
          -&gt; inexact_match('OMC', 0, 0, 2, 1, 'del')
             -&gt; inexact_match('OMC', -1, -1, 2, 1, 'ins')
             &lt;- []
          &lt;- []
          -&gt; inexact_match('OMC', -1, 0, 2, 1, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, 0, 1, 0, 'del')
             -&gt; inexact_match('OMC', -1, -1, 1, 0, 'ins')
             &lt;- []
          &lt;- []
          -&gt; inexact_match('OMC', -1, 0, 1, 0, 'missmatch')
          &lt;- []
       &lt;- [[5, 4, 'match']]
       -&gt; inexact_match('OMC', 1, 1, 0, -1, 'del')
          -&gt; inexact_match('OMC', 0, 0, 0, -1, 'ins')
             -&gt; inexact_match('OMC', -1, -1, 0, -1, 'ins')
             &lt;- []
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 0, 1, 0, -1, 'missmatch')
          -&gt; inexact_match('OMC', -1, 0, 0, -1, 'ins')
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 1, 1, 8, 7, 'del')
          -&gt; inexact_match('OMC', 0, 0, 8, 7, 'ins')
             -&gt; inexact_match('OMC', -1, -1, 8, 7, 'ins')
             &lt;- []
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 0, 1, 8, 7, 'missmatch')
          -&gt; inexact_match('OMC', -1, 0, 8, 7, 'ins')
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 1, 1, 4, 3, 'del')
          -&gt; inexact_match('OMC', 0, 0, 4, 3, 'ins')
             -&gt; inexact_match('OMC', -1, -1, 4, 3, 'ins')
             &lt;- []
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 0, 2, 4, 3, 'match')
          -&gt; inexact_match('OMC', -1, 1, 4, 3, 'ins')
          &lt;- [[4, 3, 'ins']]
       &lt;- [[4, 3, 'ins']]
       -&gt; inexact_match('OMC', 1, 1, 5, 4, 'del')
          -&gt; inexact_match('OMC', 0, 0, 5, 4, 'ins')
             -&gt; inexact_match('OMC', -1, -1, 5, 4, 'ins')
             &lt;- []
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 0, 1, 5, 4, 'missmatch')
          -&gt; inexact_match('OMC', -1, 0, 5, 4, 'ins')
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 1, 1, 2, 1, 'del')
          -&gt; inexact_match('OMC', 0, 0, 2, 1, 'ins')
             -&gt; inexact_match('OMC', -1, -1, 2, 1, 'ins')
             &lt;- []
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 0, 1, 2, 1, 'missmatch')
          -&gt; inexact_match('OMC', -1, 0, 2, 1, 'ins')
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 1, 1, 1, 0, 'del')
          -&gt; inexact_match('OMC', 0, 0, 1, 0, 'ins')
             -&gt; inexact_match('OMC', -1, -1, 1, 0, 'ins')
             &lt;- []
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 0, 1, 1, 0, 'missmatch')
          -&gt; inexact_match('OMC', -1, 0, 1, 0, 'ins')
          &lt;- []
       &lt;- []
    &lt;- [[5, 4, 'match'], [5, 5, 'match'], [5, 4, 'match'], [4, 3, 'ins']]
    -&gt; inexact_match('OMC', 2, 1, 1, 1, 'del')
       -&gt; inexact_match('OMC', 1, 0, 1, 1, 'ins')
       &lt;- []
       -&gt; inexact_match('OMC', 2, 0, 3, 2, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 3, 2, 'missmatch')
       &lt;- []
       -&gt; inexact_match('OMC', 2, 0, 0, -1, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 0, -1, 'missmatch')
       &lt;- []
       -&gt; inexact_match('OMC', 2, 0, 7, 7, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 7, 7, 'missmatch')
       &lt;- []
       -&gt; inexact_match('OMC', 2, 0, 4, 3, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 4, 3, 'missmatch')
       &lt;- []
       -&gt; inexact_match('OMC', 2, 0, 5, 4, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 5, 4, 'missmatch')
       &lt;- []
       -&gt; inexact_match('OMC', 2, 0, 2, 1, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 1, 1, 2, 1, 'match')
          -&gt; inexact_match('OMC', 0, 0, 2, 1, 'ins')
             -&gt; inexact_match('OMC', -1, -1, 2, 1, 'ins')
             &lt;- []
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 2, 0, 1, 0, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 1, 0, 'missmatch')
       &lt;- []
    &lt;- []
    -&gt; inexact_match('OMC', 1, 1, 1, 1, 'missmatch')
       -&gt; inexact_match('OMC', 0, 0, 1, 1, 'ins')
          -&gt; inexact_match('OMC', -1, -1, 1, 1, 'ins')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 3, 2, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 3, 2, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 0, -1, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 0, -1, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 7, 7, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 7, 7, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 4, 3, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 4, 3, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 5, 4, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, 0, 5, 4, 'match')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 2, 1, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 2, 1, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 1, 0, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 1, 0, 'missmatch')
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 3, 2, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 0, 0, 3, 2, 'missmatch')
          -&gt; inexact_match('OMC', -1, -1, 3, 2, 'ins')
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 0, -1, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 0, 0, 0, -1, 'missmatch')
          -&gt; inexact_match('OMC', -1, -1, 0, -1, 'ins')
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 7, 7, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 0, 0, 7, 7, 'missmatch')
          -&gt; inexact_match('OMC', -1, -1, 7, 7, 'ins')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 4, 3, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 4, 3, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 1, 0, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 1, 0, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 8, 8, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 8, 8, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 5, 4, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 5, 4, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 6, 5, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, 0, 6, 5, 'match')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 2, 1, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 2, 1, 'missmatch')
          &lt;- []
          -&gt; inexact_match('OMC', 0, -1, 2, 1, 'del')
          &lt;- []
          -&gt; inexact_match('OMC', -1, -1, 2, 1, 'missmatch')
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 4, 3, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 0, 1, 4, 3, 'match')
          -&gt; inexact_match('OMC', -1, 0, 4, 3, 'ins')
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 5, 4, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 0, 0, 5, 4, 'missmatch')
          -&gt; inexact_match('OMC', -1, -1, 5, 4, 'ins')
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 2, 1, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 0, 0, 2, 1, 'missmatch')
          -&gt; inexact_match('OMC', -1, -1, 2, 1, 'ins')
          &lt;- []
       &lt;- []
       -&gt; inexact_match('OMC', 1, 0, 1, 0, 'del')
       &lt;- []
       -&gt; inexact_match('OMC', 0, 0, 1, 0, 'missmatch')
          -&gt; inexact_match('OMC', -1, -1, 1, 0, 'ins')
          &lt;- []
       &lt;- []
    &lt;- []
 &lt;- [[5, 5, 'match'], [5, 5, 'match'], [5, 4, 'match'], [5, 5, 'match'], [5, 4, 'match'], [4, 3, 'ins']]
[[5, 5, 'match'], [5, 5, 'match'], [5, 4, 'match'], [5, 5, 'match'], [5, 4, 'match'], [4, 3, 'ins']]
OMI match
OMI match
OMI match
OMI match
OMI match
MIC ins
</pre>

</div>
</div>
</div>
</div>


<div id="outline-container-org7f6be7d" class="outline-3">
<h3 id="org7f6be7d"><span class="section-number-3">2.6.</span> Putting it all together</h3>
<div class="outline-text-3" id="text-2-6">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #e45649;">from</span> operator <span style="color: #e45649;">import</span> itemgetter


<span style="color: #e45649;">class</span> <span style="color: #986801;">BWA</span>:
    <span style="color: #e45649;">def</span> <span style="color: #a626a4;">__init__</span>(<span style="color: #e45649;">self</span>, ref):
        <span style="color: #84888b; font-style: italic;">"""todo: to be defined1."""</span>
        <span style="color: #e45649;">self</span>.<span style="color: #6a1868;">ref</span> = ref + <span style="color: #50a14f;">"$"</span>

    @<span style="color: #a626a4;">property</span>
    <span style="color: #e45649;">def</span> <span style="color: #a626a4;">last</span>(<span style="color: #e45649;">self</span>):
        <span style="color: #6a1868;">sa</span> = [<span style="color: #e45649;">self</span>.ref[i:] + <span style="color: #e45649;">self</span>.ref[:i] <span style="color: #e45649;">for</span> i <span style="color: #e45649;">in</span> <span style="color: #a626a4;">range</span>(<span style="color: #a626a4;">len</span>(<span style="color: #e45649;">self</span>.ref))]
        <span style="color: #6a1868;">idx</span>, <span style="color: #6a1868;">sa</span> = <span style="color: #a626a4;">zip</span>(*<span style="color: #a626a4;">sorted</span>(<span style="color: #a626a4;">enumerate</span>(sa), key=itemgetter(<span style="color: #da8548; font-weight: bold;">1</span>)))
        <span style="color: #e45649;">return</span> <span style="color: #50a14f;">""</span>.join(i[-<span style="color: #da8548; font-weight: bold;">1</span>] <span style="color: #e45649;">for</span> i <span style="color: #e45649;">in</span> sa), idx, sa

    @<span style="color: #a626a4;">property</span>
    <span style="color: #e45649;">def</span> <span style="color: #a626a4;">occ</span>(<span style="color: #e45649;">self</span>):
        <span style="color: #84888b; font-style: italic;">'''</span>
<span style="color: #84888b; font-style: italic;">        get the occurrences and total counts for each character in bwt</span>
<span style="color: #84888b; font-style: italic;">        '''</span>
        <span style="color: #6a1868;">totals</span> = {}
        <span style="color: #6a1868;">tallymatrix</span> = {k: [] <span style="color: #e45649;">for</span> k <span style="color: #e45649;">in</span> <span style="color: #50a14f;">""</span>.join(<span style="color: #a626a4;">set</span>(<span style="color: #e45649;">self</span>.last[<span style="color: #da8548; font-weight: bold;">0</span>]))}
        <span style="color: #e45649;">for</span> c <span style="color: #e45649;">in</span> <span style="color: #e45649;">self</span>.last[<span style="color: #da8548; font-weight: bold;">0</span>]:
            <span style="color: #e45649;">if</span> c <span style="color: #e45649;">not</span> <span style="color: #e45649;">in</span> totals:
                <span style="color: #6a1868;">totals</span>[c] = <span style="color: #da8548; font-weight: bold;">0</span>
            <span style="color: #6a1868;">totals</span>[c] += <span style="color: #da8548; font-weight: bold;">1</span>
            <span style="color: #e45649;">for</span> k <span style="color: #e45649;">in</span> tallymatrix.keys():
                <span style="color: #e45649;">if</span> k != c <span style="color: #e45649;">and</span> tallymatrix[k]:
                    tallymatrix[k].append(tallymatrix[k][-<span style="color: #da8548; font-weight: bold;">1</span>])
                <span style="color: #e45649;">elif</span> k == c:
                    tallymatrix[k].append(totals[c])
                <span style="color: #e45649;">else</span>:
                    tallymatrix[k].append(<span style="color: #da8548; font-weight: bold;">0</span>)
        <span style="color: #e45649;">return</span> tallymatrix, totals

    @<span style="color: #a626a4;">property</span>
    <span style="color: #e45649;">def</span> <span style="color: #a626a4;">first</span>(<span style="color: #e45649;">self</span>):
        <span style="color: #84888b; font-style: italic;">'''</span>
<span style="color: #84888b; font-style: italic;">        because first column is alphabetically sorted</span>
<span style="color: #84888b; font-style: italic;">        its enough to just to get start and end position for each character.</span>
<span style="color: #84888b; font-style: italic;">        '''</span>
        <span style="color: #6a1868;">first</span> = {}
        <span style="color: #6a1868;">totc</span> = <span style="color: #da8548; font-weight: bold;">0</span>
        <span style="color: #e45649;">for</span> c, count <span style="color: #e45649;">in</span> <span style="color: #a626a4;">sorted</span>(<span style="color: #e45649;">self</span>.occ[<span style="color: #da8548; font-weight: bold;">1</span>].items()):
            <span style="color: #6a1868;">first</span>[c] = (totc, totc + count - <span style="color: #da8548; font-weight: bold;">1</span>)
            <span style="color: #6a1868;">totc</span> += count
        <span style="color: #e45649;">return</span> first

    <span style="color: #e45649;">def</span> <span style="color: #a626a4;">lf</span>(<span style="color: #e45649;">self</span>, c, i):
        <span style="color: #84888b; font-style: italic;">"""</span>
<span style="color: #84888b; font-style: italic;">        the i-th occurrence of character &#8216;c&#8217; in last</span>
<span style="color: #84888b; font-style: italic;">        column is the same text character as the i-th</span>
<span style="color: #84888b; font-style: italic;">        occurrence of &#8216;c&#8217; in the first column</span>
<span style="color: #84888b; font-style: italic;">        """</span>
        <span style="color: #e45649;">return</span> <span style="color: #e45649;">self</span>.first[c][<span style="color: #da8548; font-weight: bold;">0</span>] + <span style="color: #e45649;">self</span>.occ[<span style="color: #da8548; font-weight: bold;">0</span>][c][i] - <span style="color: #da8548; font-weight: bold;">1</span>

    @<span style="color: #a626a4;">property</span>
    <span style="color: #e45649;">def</span> <span style="color: #a626a4;">rebwt</span>(<span style="color: #e45649;">self</span>):
        <span style="color: #6a1868;">i</span> = <span style="color: #da8548; font-weight: bold;">0</span>
        <span style="color: #6a1868;">t</span> = <span style="color: #50a14f;">"$"</span>
        <span style="color: #e45649;">while</span> <span style="color: #e45649;">self</span>.last[<span style="color: #da8548; font-weight: bold;">0</span>][i] != <span style="color: #50a14f;">"$"</span>:
            <span style="color: #6a1868;">c</span> = <span style="color: #e45649;">self</span>.last[<span style="color: #da8548; font-weight: bold;">0</span>][i]
            <span style="color: #6a1868;">t</span> = c + t
            <span style="color: #6a1868;">i</span> = <span style="color: #e45649;">self</span>.lf(c, i)
        <span style="color: #e45649;">return</span> t[:-<span style="color: #da8548; font-weight: bold;">1</span>]

    <span style="color: #e45649;">def</span> <span style="color: #a626a4;">exact_match</span>(<span style="color: #e45649;">self</span>, read):
        <span style="color: #6a1868;">low</span>, <span style="color: #6a1868;">high</span> = <span style="color: #e45649;">self</span>.last[<span style="color: #da8548; font-weight: bold;">0</span>].find(read[-<span style="color: #da8548; font-weight: bold;">1</span>]), <span style="color: #e45649;">self</span>.last[<span style="color: #da8548; font-weight: bold;">0</span>].rfind(read[-<span style="color: #da8548; font-weight: bold;">1</span>])

        <span style="color: #6a1868;">i</span> = <span style="color: #a626a4;">len</span>(read) - <span style="color: #da8548; font-weight: bold;">1</span>
        <span style="color: #e45649;">while</span> low &lt;= high <span style="color: #e45649;">and</span> i &gt;= <span style="color: #da8548; font-weight: bold;">0</span>:
            <span style="color: #6a1868;">low</span> = <span style="color: #e45649;">self</span>.lf(read[i], low - <span style="color: #da8548; font-weight: bold;">1</span>) + <span style="color: #da8548; font-weight: bold;">1</span>
            <span style="color: #6a1868;">high</span> = <span style="color: #e45649;">self</span>.lf(read[i], high)
            <span style="color: #6a1868;">i</span> -= <span style="color: #da8548; font-weight: bold;">1</span>
        <span style="color: #e45649;">return</span> low, high


    <span style="color: #e45649;">def</span> <span style="color: #a626a4;">inexact_search</span>(<span style="color: #e45649;">self</span>, read, z):
        <span style="color: #e45649;">self</span>.calculate_diff(read)
        <span style="color: #e45649;">return</span> <span style="color: #e45649;">self</span>.inexact_match(read, <span style="color: #a626a4;">len</span>(read) - <span style="color: #da8548; font-weight: bold;">1</span>, z, <span style="color: #da8548; font-weight: bold;">1</span>, <span style="color: #a626a4;">len</span>(<span style="color: #e45649;">self</span>.last[<span style="color: #da8548; font-weight: bold;">0</span>]) - <span style="color: #da8548; font-weight: bold;">1</span>)


    <span style="color: #e45649;">def</span> <span style="color: #a626a4;">calculate_diff</span>(<span style="color: #e45649;">self</span>, read):
        <span style="color: #84888b; font-style: italic;">'''</span>
<span style="color: #84888b; font-style: italic;">        estimate the lower bound of allowed z for every character.</span>
<span style="color: #84888b; font-style: italic;">        '''</span>
        <span style="color: #6a1868;">low</span> = <span style="color: #da8548; font-weight: bold;">1</span>
        <span style="color: #6a1868;">high</span> = <span style="color: #a626a4;">len</span>(<span style="color: #e45649;">self</span>.last[<span style="color: #da8548; font-weight: bold;">0</span>]) - <span style="color: #da8548; font-weight: bold;">1</span>
        <span style="color: #6a1868;">diffs</span> = []
        <span style="color: #6a1868;">z</span> = <span style="color: #da8548; font-weight: bold;">0</span>
        <span style="color: #e45649;">for</span> c <span style="color: #e45649;">in</span> read:
            <span style="color: #6a1868;">low</span> = <span style="color: #e45649;">self</span>.lf(c, low - <span style="color: #da8548; font-weight: bold;">1</span>) + <span style="color: #da8548; font-weight: bold;">1</span>
            <span style="color: #6a1868;">high</span> = <span style="color: #e45649;">self</span>.lf(c, high)
            <span style="color: #e45649;">if</span> low &gt; high:
                <span style="color: #6a1868;">low</span> = <span style="color: #da8548; font-weight: bold;">1</span>
                <span style="color: #6a1868;">high</span> = <span style="color: #a626a4;">len</span>(<span style="color: #e45649;">self</span>.last[<span style="color: #da8548; font-weight: bold;">0</span>]) - <span style="color: #da8548; font-weight: bold;">1</span>
                <span style="color: #6a1868;">z</span> +=  <span style="color: #da8548; font-weight: bold;">1</span>
            diffs.append(z)
        <span style="color: #e45649;">self</span>.<span style="color: #6a1868;">diffs</span> = diffs


    <span style="color: #e45649;">def</span> <span style="color: #a626a4;">inexact_match</span>(<span style="color: #e45649;">self</span>, read, i, z, low, high):
        <span style="color: #84888b; font-style: italic;">'''</span>
<span style="color: #84888b; font-style: italic;">        this function has two stop condition. either we run out of the allowed</span>
<span style="color: #84888b; font-style: italic;">        differences or we find a match.</span>
<span style="color: #84888b; font-style: italic;">        '''</span>
        <span style="color: #e45649;">if</span> z &lt; <span style="color: #e45649;">self</span>.diffs[i]:
            <span style="color: #e45649;">return</span> []
        <span style="color: #e45649;">if</span> i &lt; <span style="color: #da8548; font-weight: bold;">0</span>:
            <span style="color: #e45649;">return</span> [[low, high]]

        <span style="color: #6a1868;">matches</span> = []
        matches.extend(<span style="color: #e45649;">self</span>.inexact_match(read, i - <span style="color: #da8548; font-weight: bold;">1</span>, z - <span style="color: #da8548; font-weight: bold;">1</span>, low, high)) <span style="color: #9ca0a4;"># </span><span style="color: #9ca0a4;">insertion</span>
        <span style="color: #e45649;">for</span> c <span style="color: #e45649;">in</span> <span style="color: #a626a4;">set</span>(<span style="color: #e45649;">self</span>.last[<span style="color: #da8548; font-weight: bold;">0</span>]):
            <span style="color: #6a1868;">low_</span> = <span style="color: #e45649;">self</span>.lf(c, low - <span style="color: #da8548; font-weight: bold;">1</span>) + <span style="color: #da8548; font-weight: bold;">1</span>
            <span style="color: #6a1868;">high_</span> = <span style="color: #e45649;">self</span>.lf(c, high)
            <span style="color: #e45649;">if</span> low &lt;= high:
                matches.extend(<span style="color: #e45649;">self</span>.inexact_match(read, i, z - <span style="color: #da8548; font-weight: bold;">1</span>, low_, high_)) <span style="color: #9ca0a4;"># </span><span style="color: #9ca0a4;">deletion</span>
                <span style="color: #e45649;">if</span> c == read[i]:
                    matches.extend(<span style="color: #e45649;">self</span>.inexact_match(read, i - <span style="color: #da8548; font-weight: bold;">1</span>, z, low_, high_)) <span style="color: #9ca0a4;"># </span><span style="color: #9ca0a4;">match</span>
                <span style="color: #e45649;">else</span>:
                    matches.extend(<span style="color: #e45649;">self</span>.inexact_match(read, i - <span style="color: #da8548; font-weight: bold;">1</span>, z - <span style="color: #da8548; font-weight: bold;">1</span>, low_, high_)) <span style="color: #9ca0a4;"># </span><span style="color: #9ca0a4;">mismatch</span>
        <span style="color: #e45649;">return</span> matches

</pre>
</div>
</div>
</div>

<div id="outline-container-orgd10f402" class="outline-3">
<h3 id="orgd10f402"><span class="section-number-3">2.7.</span> Trying out with dummy data</h3>
<div class="outline-text-3" id="text-2-7">
</div>
<div id="outline-container-org76d0f31" class="outline-4">
<h4 id="org76d0f31"><span class="section-number-4">2.7.1.</span> Sequence generation</h4>
<div class="outline-text-4" id="text-2-7-1">
<p>
Lets generate our reference genome first. We are going to use the same approach as we did in <a href="https:https://omics.sbs/blog/seqmotif.html">motif finding post</a>. We are going to create our reference sequence with length <code>1200</code> with same probability of <code>.25</code> for all the bases. We add <code>$</code> character at the end to denote the end of the string which will be useful when we do the burrows wheeler below.
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #e45649;">import</span> random
random.seed(<span style="color: #da8548; font-weight: bold;">0</span>)
<span style="color: #6a1868;">alphabet</span> = [<span style="color: #50a14f;">'A'</span>, <span style="color: #50a14f;">'C'</span>, <span style="color: #50a14f;">'G'</span>, <span style="color: #50a14f;">'T'</span>]
<span style="color: #6a1868;">seq_weights</span> = [.<span style="color: #da8548; font-weight: bold;">25</span>, .<span style="color: #da8548; font-weight: bold;">25</span>, .<span style="color: #da8548; font-weight: bold;">25</span>, .<span style="color: #da8548; font-weight: bold;">25</span>]
<span style="color: #6a1868;">seq_length</span> = <span style="color: #da8548; font-weight: bold;">120</span>

<span style="color: #6a1868;">ref_seq</span> = <span style="color: #50a14f;">""</span>.join(
    random.choices(population=alphabet, weights=seq_weights, k=seq_length)
)
<span style="color: #a626a4;">print</span>(ref_seq)
</pre>
</div>

<pre class="example">
TTCCGCTCCGTGCTGCTTTTCGTGCACGTTCTCTGAGCTGACTACTAGATTCACGTAGGGTGTGGCGCGCAAGGCATTTTTTGCGCTTTGTGCGTTTAGCGTAGAATCTAAGAGTGGAGG
</pre>
</div>
</div>

<div id="outline-container-orge55d247" class="outline-4">
<h4 id="orge55d247"><span class="section-number-4">2.7.2.</span> Mutating the sequence</h4>
<div class="outline-text-4" id="text-2-7-2">
<p>
We want our reads to be different from our reference so, before sampling our samples we are going to create a mutated sequence first. Here with the <code>mutated</code> function we decide if mutation occurs with the given percentage and if it does type of the mutation. With the <code>mutate_read</code> function we either insert a single base, substitute a base or remove a base.
</p>

<div class="org-src-container">
<pre class="src src-python">
<span style="color: #e45649;">def</span> <span style="color: #a626a4;">mutated</span>(mutation_rate):
    <span style="color: #6a1868;">r</span> = random.randint(<span style="color: #da8548; font-weight: bold;">1</span>,<span style="color: #da8548; font-weight: bold;">100</span>)
    <span style="color: #e45649;">if</span> r &lt;= mutation_rate:
        <span style="color: #6a1868;">r</span> = random.randint(<span style="color: #da8548; font-weight: bold;">1</span>,<span style="color: #da8548; font-weight: bold;">100</span>)
        <span style="color: #e45649;">if</span> r &lt;= <span style="color: #da8548; font-weight: bold;">25</span>:
            <span style="color: #e45649;">return</span> <span style="color: #50a14f;">'del'</span>
        <span style="color: #e45649;">elif</span> <span style="color: #da8548; font-weight: bold;">25</span> &lt; r &lt;= <span style="color: #da8548; font-weight: bold;">50</span>:
            <span style="color: #e45649;">return</span> <span style="color: #50a14f;">'ins'</span>
        <span style="color: #e45649;">else</span>:
            <span style="color: #e45649;">return</span> <span style="color: #50a14f;">'sub'</span>
    <span style="color: #e45649;">else</span>:
        <span style="color: #e45649;">return</span> <span style="color: #b751b6;">False</span>


<span style="color: #e45649;">def</span> <span style="color: #a626a4;">mutate</span>(sequence, mutation_rate):
    <span style="color: #6a1868;">mutated_seq</span> = <span style="color: #50a14f;">''</span>
    <span style="color: #6a1868;">mutated_once</span> = <span style="color: #b751b6;">False</span>
    <span style="color: #e45649;">for</span> base <span style="color: #e45649;">in</span> sequence:
        <span style="color: #6a1868;">mutatition_type</span> = mutated(mutation_rate)
        <span style="color: #e45649;">match</span> mutatition_type:
            <span style="color: #e45649;">case</span> <span style="color: #50a14f;">'del'</span>:
                <span style="color: #e45649;">pass</span>
            <span style="color: #e45649;">case</span> <span style="color: #50a14f;">'ins'</span>:
                <span style="color: #6a1868;">possible_mutations</span> = <span style="color: #50a14f;">""</span>.join([<span style="color: #50a14f;">'A'</span>, <span style="color: #50a14f;">'T'</span>, <span style="color: #50a14f;">'C'</span>, <span style="color: #50a14f;">'G'</span>])
                <span style="color: #6a1868;">mutantion</span> = random.choice(possible_mutations)
                <span style="color: #6a1868;">mutated_seq</span> += base
                <span style="color: #6a1868;">mutated_seq</span> += mutantion
            <span style="color: #e45649;">case</span> <span style="color: #50a14f;">'sub'</span>:
                <span style="color: #6a1868;">possible_mutations</span> = <span style="color: #50a14f;">""</span>.join([<span style="color: #50a14f;">'A'</span>, <span style="color: #50a14f;">'T'</span>, <span style="color: #50a14f;">'C'</span>, <span style="color: #50a14f;">'G'</span>])
                <span style="color: #6a1868;">possible_mutations</span> = possible_mutations.replace(base, <span style="color: #50a14f;">''</span>)
                <span style="color: #6a1868;">mutantion</span> = random.choice(possible_mutations)
                <span style="color: #6a1868;">mutated_seq</span> += mutantion
            <span style="color: #e45649;">case</span> _:
                <span style="color: #6a1868;">mutated_seq</span> += base
    <span style="color: #e45649;">return</span> mutated_seq
</pre>
</div>

<p>
After mutation with rate .5 we got our new mutated string some indels and substitutions.
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #6a1868;">mt_seq</span> = mutate(ref_seq, <span style="color: #da8548; font-weight: bold;">5</span>)
<span style="color: #a626a4;">print</span>(f<span style="color: #50a14f;">"</span>{ref_seq=}<span style="color: #50a14f;">"</span>)
<span style="color: #a626a4;">print</span>(f<span style="color: #50a14f;">" </span>{mt_seq=}<span style="color: #50a14f;">"</span>)
</pre>
</div>

<pre class="example">
ref_seq='TTCCGCTCCGTGCTGCTTTTCGTGCACGTTCTCTGAGCTGACTACTAGATTCACGTAGGGTGTGGCGCGCAAGGCATTTTTTGCGCTTTGTGCGTTTAGCGTAGAATCTAAGAGTGGAGG'
 mt_seq='TTCCGCTCCGTGCTGCTTTTCGTGCACGTTCTCTGAGCTGACTACTAATTCATGTAGGGTGTGGCGCGCAAGGCATTTTTTGCGCTTTGTGCGTTTGGCGTAGAACTAAGAGTGGAGG'
</pre>
</div>
</div>

<div id="outline-container-orgfa310c0" class="outline-4">
<h4 id="orgfa310c0"><span class="section-number-4">2.7.3.</span> Getting the reads</h4>
<div class="outline-text-4" id="text-2-7-3">
<p>
Lets randomly sample 600 reads with length 6 from our mutated sequence.
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #6a1868;">number_of_reads</span> = <span style="color: #da8548; font-weight: bold;">600</span>
<span style="color: #6a1868;">read_length</span> = <span style="color: #da8548; font-weight: bold;">6</span>
<span style="color: #6a1868;">random_indices</span> = [random.randrange(<span style="color: #a626a4;">len</span>(mt_seq) - read_length) <span style="color: #e45649;">for</span> _ <span style="color: #e45649;">in</span> <span style="color: #a626a4;">range</span>(number_of_reads)]
<span style="color: #6a1868;">mt_reads</span> = [mt_seq[i:i + read_length] <span style="color: #e45649;">for</span> i <span style="color: #e45649;">in</span> random_indices]
<span style="color: #a626a4;">print</span>(mt_reads[:<span style="color: #da8548; font-weight: bold;">20</span>])
</pre>
</div>

<pre class="example">
['AGAGTG', 'TCATGT', 'GCGTAG', 'GTAGGG', 'CTCCGT', 'TGAGCT', 'GCGCAA', 'GGCGCG', 'ATGTAG', 'TAGAAC', 'TAAGAG', 'TGACTA', 'TGGCGC', 'TAATTC', 'ATTTTT', 'GTTCTC', 'CGCGCA', 'TTTCGT', 'GCTGAC', 'TTTCGT']
</pre>


<p>
We can now try to align our reads from the <code>mutated_sequence</code> back to the our reference. Since BWA returns many matches we are just gonna get the most common one using the <a href="https://stackoverflow.com/a/1520716/7141527">snippet here.</a>
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #9ca0a4;"># </span><span style="color: #9ca0a4;">Code from: https://stackoverflow.com/a/1520716/7141527</span>
<span style="color: #9ca0a4;"># </span><span style="color: #9ca0a4;">Get the most common match</span>
<span style="color: #e45649;">import</span> itertools
<span style="color: #e45649;">import</span> operator

<span style="color: #e45649;">def</span> <span style="color: #a626a4;">most_common</span>(L):
  <span style="color: #9ca0a4;"># </span><span style="color: #9ca0a4;">get an iterable of (item, iterable) pairs</span>
  <span style="color: #6a1868;">SL</span> = <span style="color: #a626a4;">sorted</span>((x, i) <span style="color: #e45649;">for</span> i, x <span style="color: #e45649;">in</span> <span style="color: #a626a4;">enumerate</span>(L))
  <span style="color: #9ca0a4;"># </span><span style="color: #9ca0a4;">print 'SL:', SL</span>
  <span style="color: #6a1868;">groups</span> = itertools.groupby(SL, key=operator.itemgetter(<span style="color: #da8548; font-weight: bold;">0</span>))
  <span style="color: #9ca0a4;"># </span><span style="color: #9ca0a4;">auxiliary function to get "quality" for an item</span>
  <span style="color: #e45649;">def</span> <span style="color: #a626a4;">_auxfun</span>(g):
    <span style="color: #6a1868;">item</span>, <span style="color: #6a1868;">iterable</span> = g
    <span style="color: #6a1868;">count</span> = <span style="color: #da8548; font-weight: bold;">0</span>
    <span style="color: #6a1868;">min_index</span> = <span style="color: #a626a4;">len</span>(L)
    <span style="color: #e45649;">for</span> _, where <span style="color: #e45649;">in</span> iterable:
      <span style="color: #6a1868;">count</span> += <span style="color: #da8548; font-weight: bold;">1</span>
      <span style="color: #6a1868;">min_index</span> = <span style="color: #a626a4;">min</span>(min_index, where)
    <span style="color: #9ca0a4;"># </span><span style="color: #9ca0a4;">print 'item %r, count %r, minind %r' % (item, count, min_index)</span>
    <span style="color: #e45649;">return</span> count, -min_index
  <span style="color: #9ca0a4;"># </span><span style="color: #9ca0a4;">pick the highest-count/earliest item</span>
  <span style="color: #e45649;">return</span> <span style="color: #a626a4;">max</span>(groups, key=_auxfun)[<span style="color: #da8548; font-weight: bold;">0</span>]
</pre>
</div>
</div>
</div>

<div id="outline-container-org9bfb0f0" class="outline-4">
<h4 id="org9bfb0f0"><span class="section-number-4">2.7.4.</span> Performing the alignment</h4>
<div class="outline-text-4" id="text-2-7-4">
<p>
First lets initialize our BWA class with the <code>ref_seq</code>. Then we are going to align our mutated reads and keep track of the most common matches. Then we are going the get the <code>initial_ind</code> from <code>bwa.last[1]</code> using the <code>low</code> value.
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #6a1868;">bwa</span> = BWA(ref_seq)
<span style="color: #6a1868;">alignment_indices</span> = []
<span style="color: #e45649;">for</span> mt_read <span style="color: #e45649;">in</span> mt_reads:
    <span style="color: #6a1868;">matches</span>=bwa.inexact_search(mt_read, <span style="color: #da8548; font-weight: bold;">2</span>)
    <span style="color: #e45649;">if</span> matches:
        <span style="color: #9ca0a4;"># </span><span style="color: #9ca0a4;">match = most_common(matches)</span>
        <span style="color: #e45649;">match</span> = matches[<span style="color: #da8548; font-weight: bold;">0</span>]
        alignment_indices.append(bwa.last[<span style="color: #da8548; font-weight: bold;">1</span>][<span style="color: #e45649;">match</span>[<span style="color: #da8548; font-weight: bold;">0</span>]])
    <span style="color: #e45649;">else</span>:
        alignment_indices.append(<span style="color: #da8548; font-weight: bold;">0</span>)

<span style="color: #a626a4;">print</span>(f<span style="color: #50a14f;">"</span>{   random_indices[:20]=}<span style="color: #50a14f;">"</span>)
<span style="color: #a626a4;">print</span>(f<span style="color: #50a14f;">"</span>{alignment_indices[:20]=}<span style="color: #50a14f;">"</span>)
</pre>
</div>

<pre class="example">
   random_indices[20:]=[96, 12, 79, 102, 32, 68, 90, 103, 77, 18, 39, 12, 93, 9, 108, 87, 42, 60, 71, 12]
alignment_indices[20:]=[57, 12, 80, 39, 32, 69, 98, 109, 78, 18, 39, 12, 79, 9, 110, 88, 42, 61, 72, 12]
</pre>
</div>
</div>

<div id="outline-container-org981b992" class="outline-4">
<h4 id="org981b992"><span class="section-number-4">2.7.5.</span> Outputing to SAM</h4>
<div class="outline-text-4" id="text-2-7-5">
<p>
Lets output our alignmets as Sequence Alignment/Map (SAM) format. SAM has header lines starting with `@´ and 11 fields denoting various alignment properties. We are going to fill in just the QNAME, POS, TLEN and SEQ fields.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">Col</th>
<th scope="col" class="org-left">Field</th>
<th scope="col" class="org-left">Type</th>
<th scope="col" class="org-left">Regexp/Range</th>
<th scope="col" class="org-left">Brief description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-left">QNAME</td>
<td class="org-left">String</td>
<td class="org-left">[!-?A-~]{1,254}</td>
<td class="org-left">Query template NAME</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-left">FLAG</td>
<td class="org-left">Int</td>
<td class="org-left">[0, \(2^{16}\) − 1]</td>
<td class="org-left">bitwise FLAG</td>
</tr>

<tr>
<td class="org-right">3</td>
<td class="org-left">RNAME</td>
<td class="org-left">String</td>
<td class="org-left">\*&vert;[:rname:<sup>*</sup>=][:rname:]*</td>
<td class="org-left">Reference sequence NAME11</td>
</tr>

<tr>
<td class="org-right">4</td>
<td class="org-left">POS</td>
<td class="org-left">Int</td>
<td class="org-left">[0, \(2^{31}\) − 1]</td>
<td class="org-left">1-based leftmost mapping POSition</td>
</tr>

<tr>
<td class="org-right">5</td>
<td class="org-left">MAPQ</td>
<td class="org-left">Int</td>
<td class="org-left">[0, \(2^{8}\) − 1]</td>
<td class="org-left">MAPping Quality</td>
</tr>

<tr>
<td class="org-right">6</td>
<td class="org-left">CIGAR</td>
<td class="org-left">String</td>
<td class="org-left">\*&vert;([0-9]+[MIDNSHPX=])+</td>
<td class="org-left">CIGAR string</td>
</tr>

<tr>
<td class="org-right">7</td>
<td class="org-left">RNEXT</td>
<td class="org-left">String</td>
<td class="org-left">\*&vert;=&vert;[:rname:<sup>*</sup>=][:rname:]*</td>
<td class="org-left">Reference name of the mate/next read</td>
</tr>

<tr>
<td class="org-right">8</td>
<td class="org-left">PNEXT</td>
<td class="org-left">Int</td>
<td class="org-left">[0, \(2^{31}\) − 1]</td>
<td class="org-left">Position of the mate/next read</td>
</tr>

<tr>
<td class="org-right">9</td>
<td class="org-left">TLEN</td>
<td class="org-left">Int</td>
<td class="org-left">[\(−2^{31} + 1, 2^{31} − 1\)]</td>
<td class="org-left">observed Template LENgth</td>
</tr>

<tr>
<td class="org-right">10</td>
<td class="org-left">SEQ</td>
<td class="org-left">String</td>
<td class="org-left">\*&vert;[A-Za-z=.]+</td>
<td class="org-left">segment SEQuence</td>
</tr>

<tr>
<td class="org-right">11</td>
<td class="org-left">QUAL</td>
<td class="org-left">String</td>
<td class="org-left">[!-~]+</td>
<td class="org-left">ASCII of Phred-scaled base QUALity+33</td>
</tr>
</tbody>
</table>

<p>
For header we are going to print a version number, reference sequence name and length.
For our alignments we are going to create a name for them and sort them and print their alignment index with their sequence.
Ideally, reads that haven&rsquo;t aligned should be flagged with 0x4. However we are
just gonna skip them. Another thing we are skipping over is the CIGAR entries
which says where are the indels and mismatches we are just gonna write
everything is matched.
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #6a1868;">sam_contents</span> = <span style="color: #50a14f;">""</span>
<span style="color: #6a1868;">sam_header</span> = f<span style="color: #50a14f;">"@HD</span><span style="color: #b751b6;">\t</span><span style="color: #50a14f;">VN:1.6</span><span style="color: #b751b6;">\t</span><span style="color: #50a14f;">SO:coordinate</span><span style="color: #b751b6;">\n</span><span style="color: #50a14f;">@SQ</span><span style="color: #b751b6;">\t</span><span style="color: #50a14f;">SN:REF</span><span style="color: #b751b6;">\t</span><span style="color: #50a14f;">LN:</span>{<span style="color: #a626a4;">len</span>(ref_seq)}<span style="color: #b751b6;">\n</span><span style="color: #50a14f;">"</span>
<span style="color: #6a1868;">sam_contents</span> += sam_header

<span style="color: #6a1868;">mapped_reads</span> = {i: read <span style="color: #e45649;">for</span> i, read <span style="color: #e45649;">in</span> <span style="color: #a626a4;">sorted</span>(<span style="color: #a626a4;">zip</span>(alignment_indices, mt_reads))}
<span style="color: #e45649;">for</span> i, read <span style="color: #e45649;">in</span> mapped_reads.items():
    <span style="color: #9ca0a4;">#                </span><span style="color: #9ca0a4;">QNAME  FLAG RNAME POS MAPQ CIGAR RNEXT PNEXT TLEN SEQ     QUAL</span>
    <span style="color: #e45649;">if</span> i == <span style="color: #da8548; font-weight: bold;">0</span>:
        <span style="color: #e45649;">continue</span>
    <span style="color: #e45649;">else</span>:
        <span style="color: #6a1868;">sam_contents</span> += f<span style="color: #50a14f;">"read</span>{i}<span style="color: #b751b6;">\t</span><span style="color: #50a14f;">0</span><span style="color: #b751b6;">\t</span><span style="color: #50a14f;">REF</span><span style="color: #b751b6;">\t</span>{i+1}<span style="color: #b751b6;">\t</span><span style="color: #50a14f;">30</span><span style="color: #b751b6;">\t</span><span style="color: #50a14f;">6M</span><span style="color: #b751b6;">\t</span><span style="color: #50a14f;">*</span><span style="color: #b751b6;">\t</span><span style="color: #50a14f;">0</span><span style="color: #b751b6;">\t</span>{<span style="color: #a626a4;">len</span>(read)}<span style="color: #b751b6;">\t</span>{read}<span style="color: #b751b6;">\t</span>{'K'*<span style="color: #a626a4;">len</span>(read)}<span style="color: #b751b6;">\n</span><span style="color: #50a14f;">"</span>

<span style="color: #a626a4;">print</span>(sam_contents)
</pre>
</div>

<pre class="example" id="org527482d">
@HD	VN:1.6	SO:coordinate
@SQ	SN:REF	LN:120
read1	0	REF	2	30	6M	*	0	6	TCCGCT	KKKKKK
read2	0	REF	3	30	6M	*	0	6	CCGCTC	KKKKKK
read3	0	REF	4	30	6M	*	0	6	CGCTCC	KKKKKK
read4	0	REF	5	30	6M	*	0	6	GCTCCG	KKKKKK
read5	0	REF	6	30	6M	*	0	6	CTCCGT	KKKKKK
read6	0	REF	7	30	6M	*	0	6	TCCGTG	KKKKKK
read7	0	REF	8	30	6M	*	0	6	CCGTGC	KKKKKK
read9	0	REF	10	30	6M	*	0	6	GTGCTG	KKKKKK
read10	0	REF	11	30	6M	*	0	6	TGCTTT	KKKKKK
read11	0	REF	12	30	6M	*	0	6	GCTGCT	KKKKKK
read12	0	REF	13	30	6M	*	0	6	CTGCTT	KKKKKK
read16	0	REF	17	30	6M	*	0	6	TTTTTT	KKKKKK
read17	0	REF	18	30	6M	*	0	6	TTTCGT	KKKKKK
read18	0	REF	19	30	6M	*	0	6	TTCGTG	KKKKKK
read19	0	REF	20	30	6M	*	0	6	TCGTGC	KKKKKK
read20	0	REF	21	30	6M	*	0	6	CGTGCT	KKKKKK
read21	0	REF	22	30	6M	*	0	6	GTGCAC	KKKKKK
read22	0	REF	23	30	6M	*	0	6	TGCACG	KKKKKK
read23	0	REF	24	30	6M	*	0	6	GCACGT	KKKKKK
read25	0	REF	26	30	6M	*	0	6	ACGTTC	KKKKKK
read26	0	REF	27	30	6M	*	0	6	CGTTCT	KKKKKK
read27	0	REF	28	30	6M	*	0	6	GTTCTC	KKKKKK
read28	0	REF	29	30	6M	*	0	6	TTCTCT	KKKKKK
read30	0	REF	31	30	6M	*	0	6	CTCTGA	KKKKKK
read31	0	REF	32	30	6M	*	0	6	TCTGAG	KKKKKK
read32	0	REF	33	30	6M	*	0	6	CTGAGC	KKKKKK
read33	0	REF	34	30	6M	*	0	6	TGAGCT	KKKKKK
read34	0	REF	35	30	6M	*	0	6	GAGCTG	KKKKKK
read35	0	REF	36	30	6M	*	0	6	AGCTGA	KKKKKK
read36	0	REF	37	30	6M	*	0	6	GCTGAC	KKKKKK
read37	0	REF	38	30	6M	*	0	6	CTGACT	KKKKKK
read38	0	REF	39	30	6M	*	0	6	TGACTA	KKKKKK
read39	0	REF	40	30	6M	*	0	6	GACTAC	KKKKKK
read40	0	REF	41	30	6M	*	0	6	ACTACT	KKKKKK
read41	0	REF	42	30	6M	*	0	6	CTACTA	KKKKKK
read42	0	REF	43	30	6M	*	0	6	TACTAA	KKKKKK
read44	0	REF	45	30	6M	*	0	6	CTAATT	KKKKKK
read48	0	REF	49	30	6M	*	0	6	ATTCAT	KKKKKK
read51	0	REF	52	30	6M	*	0	6	CATGTA	KKKKKK
read52	0	REF	53	30	6M	*	0	6	AATTCA	KKKKKK
read54	0	REF	55	30	6M	*	0	6	GTAGGG	KKKKKK
read55	0	REF	56	30	6M	*	0	6	TAGGGT	KKKKKK
read56	0	REF	57	30	6M	*	0	6	AGGGTG	KKKKKK
read57	0	REF	58	30	6M	*	0	6	GGGTGT	KKKKKK
read58	0	REF	59	30	6M	*	0	6	GGTGTG	KKKKKK
read59	0	REF	60	30	6M	*	0	6	GTGTGG	KKKKKK
read60	0	REF	61	30	6M	*	0	6	TGTGGC	KKKKKK
read61	0	REF	62	30	6M	*	0	6	GTGGCG	KKKKKK
read62	0	REF	63	30	6M	*	0	6	TGGCGT	KKKKKK
read63	0	REF	64	30	6M	*	0	6	GGCGCG	KKKKKK
read64	0	REF	65	30	6M	*	0	6	GCGCGC	KKKKKK
read65	0	REF	66	30	6M	*	0	6	CGCGCA	KKKKKK
read66	0	REF	67	30	6M	*	0	6	GCGCAA	KKKKKK
read67	0	REF	68	30	6M	*	0	6	CGCAAG	KKKKKK
read68	0	REF	69	30	6M	*	0	6	GCAAGG	KKKKKK
read69	0	REF	70	30	6M	*	0	6	CAAGGC	KKKKKK
read70	0	REF	71	30	6M	*	0	6	AAGGCA	KKKKKK
read71	0	REF	72	30	6M	*	0	6	AGGCAT	KKKKKK
read72	0	REF	73	30	6M	*	0	6	GGCATT	KKKKKK
read73	0	REF	74	30	6M	*	0	6	GCATTT	KKKKKK
read74	0	REF	75	30	6M	*	0	6	CATTTT	KKKKKK
read75	0	REF	76	30	6M	*	0	6	ATTTTT	KKKKKK
read77	0	REF	78	30	6M	*	0	6	TTTTTG	KKKKKK
read78	0	REF	79	30	6M	*	0	6	TTTTGC	KKKKKK
read79	0	REF	80	30	6M	*	0	6	TTTGGC	KKKKKK
read80	0	REF	81	30	6M	*	0	6	TTGCGC	KKKKKK
read81	0	REF	82	30	6M	*	0	6	TGCGCT	KKKKKK
read82	0	REF	83	30	6M	*	0	6	GCGCTT	KKKKKK
read83	0	REF	84	30	6M	*	0	6	CGCTTT	KKKKKK
read84	0	REF	85	30	6M	*	0	6	GCTTTT	KKKKKK
read85	0	REF	86	30	6M	*	0	6	CTTTTC	KKKKKK
read86	0	REF	87	30	6M	*	0	6	TTTGTG	KKKKKK
read87	0	REF	88	30	6M	*	0	6	TTGTGC	KKKKKK
read88	0	REF	89	30	6M	*	0	6	TGTGCG	KKKKKK
read89	0	REF	90	30	6M	*	0	6	GTGCGT	KKKKKK
read90	0	REF	91	30	6M	*	0	6	TGCGTT	KKKKKK
read92	0	REF	93	30	6M	*	0	6	CGTTTG	KKKKKK
read98	0	REF	99	30	6M	*	0	6	GCGTTT	KKKKKK
read99	0	REF	100	30	6M	*	0	6	CGTAGA	KKKKKK
read100	0	REF	101	30	6M	*	0	6	GTAGAA	KKKKKK
read101	0	REF	102	30	6M	*	0	6	TAGAAC	KKKKKK
read102	0	REF	103	30	6M	*	0	6	AGAACT	KKKKKK
read107	0	REF	108	30	6M	*	0	6	CTAAGA	KKKKKK
read108	0	REF	109	30	6M	*	0	6	TAAGAG	KKKKKK
read109	0	REF	110	30	6M	*	0	6	AAGAGT	KKKKKK
read110	0	REF	111	30	6M	*	0	6	AGAGTG	KKKKKK
read111	0	REF	112	30	6M	*	0	6	GAGTGG	KKKKKK
read112	0	REF	113	30	6M	*	0	6	AGTGGA	KKKKKK
read113	0	REF	114	30	6M	*	0	6	GTGGAG	KKKKKK
</pre>

<p>
Lets write our alignments to a file as well as our reference sequence.
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #e45649;">with</span> <span style="color: #a626a4;">open</span>(<span style="color: #50a14f;">'myalignments.sam'</span>, <span style="color: #50a14f;">'w'</span>) <span style="color: #e45649;">as</span> f:
    f.write(sam_contents)
<span style="color: #e45649;">with</span> <span style="color: #a626a4;">open</span>(<span style="color: #50a14f;">'ref.fasta'</span>, <span style="color: #50a14f;">'w'</span>) <span style="color: #e45649;">as</span> f:
    f.write(<span style="color: #50a14f;">'&gt;REF</span><span style="color: #b751b6;">\n</span><span style="color: #50a14f;">'</span>)
    f.write(ref_seq)
</pre>
</div>
</div>
</div>

<div id="outline-container-org0d4b416" class="outline-4">
<h4 id="org0d4b416"><span class="section-number-4">2.7.6.</span> Visualizing our alignments with IGV</h4>
<div class="outline-text-4" id="text-2-7-6">
<p>
With SAM and FASTA files we can visualize our alignmets with IGV. We can convert our SAM to BAM and index both BAM and FASTA files with samtools.
</p>
<div class="org-src-container">
<pre class="src src-shell">samtools view ./myalignments.sam -bh &gt; ./myalignments.bam
samtools index ./myalignments.bam

samtools faidx ./ref.fasta
</pre>
</div>


<div id="org94ea8c1" class="figure">
<p><img src="./igv.svg" alt="igv.svg" class="org-svg" width="100%" />
</p>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org2a55f3c" class="outline-2">
<h2 id="org2a55f3c"><span class="section-number-2">3.</span> Referanslar</h2>
<div class="outline-text-2" id="text-3">
<style>.csl-entry{text-indent: -1.5em; margin-left: 1.5em;}</style><div class="csl-bib-body">
  <div class="csl-entry"><a id="citeproc_bib_item_1"></a>Li, Heng, and Richard Durbin. 2009. “Fast and Accurate Short Read Alignment with Burrows-Wheeler Transform.” <i>Bioinformatics (Oxford, England)</i> 25 (14): 1754–60. <a href="https://doi.org/10.1093/bioinformatics/btp324">https://doi.org/10.1093/bioinformatics/btp324</a>.</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">

<script src="https://omics.sbs/static/base/js/script.js"></script>
</div>
</body>
</html>